<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POSKedai - Sistem POS</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#f97316;--primary-dark:#ea580c;--primary-light:#fff7ed;--primary-bg:#ffedd5;--success:#34d399;--success-dark:#10b981;--success-light:#ecfdf5;--danger:#f87171;--danger-dark:#ef4444;--danger-light:#fef2f2;--warning:#fbbf24;--warning-dark:#f59e0b;--info:#60a5fa;--info-dark:#3b82f6;--info-light:#eff6ff;--dark:#0f172a;--dark-2:#1e293b;--dark-3:#334155;--gray:#64748b;--gray-light:#94a3b8;--gray-lighter:#cbd5e1;--border:#e2e8f0;--bg:#f1f5f9;--bg-2:#f8fafc;--white:#ffffff;--shadow-xs:0 1px 2px rgba(0,0,0,0.04);--shadow-sm:0 2px 8px rgba(0,0,0,0.04),0 1px 2px rgba(0,0,0,0.06);--shadow:0 4px 24px rgba(0,0,0,0.06);--shadow-lg:0 12px 40px rgba(0,0,0,0.08);--shadow-xl:0 24px 60px rgba(0,0,0,0.12);--shadow-primary:0 8px 30px rgba(249,115,22,0.25);--radius:16px;--radius-lg:20px;--radius-xl:28px;--radius-full:50px;--font:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;--ease:cubic-bezier(0.4,0,0.2,1)}
        body{font-family:var(--font);background:var(--bg);color:var(--dark);min-height:100vh;-webkit-tap-highlight-color:transparent;-webkit-font-smoothing:antialiased;overflow-x:hidden}
        .login-screen{min-height:100vh;background:linear-gradient(145deg,#fff7ed 0%,#fed7aa 30%,#fdba74 60%,#fb923c 100%);display:flex;align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden}
        .login-screen::before{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle,rgba(255,255,255,0.2),transparent 70%);top:-100px;right:-100px;border-radius:50%}
        .login-screen::after{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(249,115,22,0.15),transparent 70%);bottom:-80px;left:-80px;border-radius:50%}
        .login-card{background:rgba(255,255,255,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:var(--radius-xl);padding:48px 36px;width:100%;max-width:400px;box-shadow:var(--shadow-xl),0 0 0 1px rgba(255,255,255,0.5);text-align:center;position:relative;z-index:2}
        .login-logo{font-size:2.2rem;font-weight:900;margin-bottom:4px;letter-spacing:-1px}.login-logo span:first-child{color:var(--primary)}.login-logo span:last-child{color:var(--dark)}
        .login-subtitle{color:var(--gray);font-size:0.88rem;margin-bottom:36px;font-weight:500}
        .login-shop-name{font-size:1.05rem;font-weight:700;color:var(--dark-2);margin-bottom:28px;padding:14px 20px;background:rgba(249,115,22,0.08);border-radius:14px;border:1px solid rgba(249,115,22,0.12)}
        .pin-input{width:100%;padding:18px;border:2px solid var(--border);border-radius:14px;font-size:1.5rem;font-weight:700;text-align:center;letter-spacing:14px;margin-bottom:20px;transition:all 0.3s var(--ease);font-family:var(--font);background:var(--white)}.pin-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.1)}.pin-input::placeholder{letter-spacing:4px;font-size:1rem;color:var(--gray-lighter)}
        .btn-login{width:100%;padding:18px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);border:none;border-radius:14px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s var(--ease);box-shadow:var(--shadow-primary);font-family:var(--font)}.btn-login:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(249,115,22,0.35)}.btn-login:active{transform:scale(0.98)}
        .login-skip{margin-top:20px;color:var(--gray);font-size:0.85rem;cursor:pointer;font-weight:500;transition:color 0.2s}.login-skip:hover{color:var(--primary)}
        .app-container{display:none}.app-container.show{display:block}
        .offline-banner{display:none;background:var(--danger);color:white;text-align:center;padding:8px;font-size:0.78rem;font-weight:700}.offline-banner.show{display:block}
        .header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);padding:16px 20px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}
        .header-left{display:flex;align-items:center;gap:12px}.header-logo{font-weight:900;font-size:1.15rem;letter-spacing:-0.5px}
        .header-staff{background:rgba(255,255,255,0.18);padding:5px 14px;border-radius:var(--radius-full);font-size:0.75rem;font-weight:600;backdrop-filter:blur(8px)}
        .header-right{display:flex;align-items:center;gap:10px}.header-counter{background:rgba(255,255,255,0.18);padding:5px 14px;border-radius:var(--radius-full);font-size:0.8rem;font-weight:700}.header-time{font-size:0.8rem;opacity:0.85;font-weight:500}
        .btn-logout{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.25);color:white;padding:7px 16px;border-radius:12px;font-size:0.75rem;font-weight:600;cursor:pointer;font-family:var(--font);transition:all 0.2s}.btn-logout:hover{background:rgba(255,255,255,0.22)}
        .offline-dot{display:none;width:8px;height:8px;background:var(--danger);border-radius:50%;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(1.3)}}
        .nav-tabs{display:flex;background:var(--white);position:sticky;top:56px;z-index:99;padding:4px;gap:2px;border-bottom:1px solid var(--border)}
        .nav-tab{flex:1;padding:10px 6px 8px;text-align:center;cursor:pointer;border:none;background:transparent;font-size:0.68rem;font-weight:600;color:var(--gray-light);border-radius:12px;transition:all 0.3s var(--ease);min-width:55px;white-space:nowrap;font-family:var(--font)}.nav-tab.active{color:var(--primary);background:var(--primary-light)}.nav-tab .tab-icon{font-size:1.2rem;display:block;margin-bottom:2px}
        .tab-content{display:none;padding:16px;max-width:1400px;margin:0 auto;padding-bottom:80px;animation:fadeIn 0.4s var(--ease)}.tab-content.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .order-layout{display:flex;gap:24px;align-items:flex-start}.order-left{flex:1;min-width:0}.order-right{width:380px;flex-shrink:0;position:sticky;top:120px;max-height:calc(100vh - 140px);display:flex;flex-direction:column}.order-right::-webkit-scrollbar{width:4px}.order-right::-webkit-scrollbar-thumb{background:var(--gray-lighter);border-radius:4px}.order-right .card{display:flex;flex-direction:column;max-height:calc(100vh - 160px);margin-bottom:0;border:1.5px solid var(--border);box-shadow:var(--shadow)}.cart-scroll{flex:1;overflow-y:auto;min-height:0;padding-right:4px}.cart-scroll::-webkit-scrollbar{width:3px}.cart-scroll::-webkit-scrollbar-thumb{background:var(--gray-lighter);border-radius:3px}.cart-footer{border-top:2px solid var(--bg);padding-top:14px;margin-top:10px;flex-shrink:0}
        .card{background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius-lg);padding:20px;margin-bottom:14px;box-shadow:var(--shadow-sm);transition:all 0.3s var(--ease)}.card-title{font-size:0.95rem;font-weight:800;margin-bottom:16px;display:flex;align-items:center;gap:8px;color:var(--dark)}
        .search-bar{position:relative;margin-bottom:14px}.search-bar input{width:100%;padding:14px 18px 14px 44px;border:1px solid var(--border);border-radius:14px;font-size:0.9rem;font-family:var(--font);transition:all 0.3s var(--ease);background:var(--white)}.search-bar input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}.search-bar::before{content:"üîç";position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:0.9rem}
        .category-filter{display:flex;gap:8px;overflow-x:auto;padding-bottom:8px;margin-bottom:14px;-webkit-overflow-scrolling:touch}.category-filter::-webkit-scrollbar{display:none}
        .cat-chip{padding:9px 20px;border-radius:var(--radius-full);border:1px solid var(--border);background:var(--white);font-size:0.82rem;font-weight:600;cursor:pointer;white-space:nowrap;transition:all 0.25s var(--ease);color:var(--gray);font-family:var(--font)}.cat-chip.active{background:var(--primary);color:var(--white);border-color:var(--primary);box-shadow:0 4px 14px rgba(249,115,22,0.25)}
        .menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px}
        .menu-item{background:var(--white);border:1.5px solid var(--border);border-radius:var(--radius);padding:16px 10px;text-align:center;cursor:pointer;transition:all 0.25s var(--ease);position:relative;user-select:none}.menu-item:active{transform:scale(0.96)}.menu-item:hover{border-color:rgba(249,115,22,0.3);box-shadow:var(--shadow)}.menu-item.selected{border-color:var(--primary);background:var(--primary-light);box-shadow:0 0 0 3px rgba(249,115,22,0.1)}.menu-item .item-cat{font-size:0.62rem;color:var(--gray-light);font-weight:600;margin-bottom:3px;text-transform:uppercase;letter-spacing:0.5px}.menu-item .item-name{font-weight:700;font-size:0.85rem;color:var(--dark-2);margin-bottom:5px;line-height:1.2}.menu-item .item-price{color:var(--primary);font-weight:800;font-size:1rem}.menu-item .item-badge{position:absolute;top:-8px;right:-8px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:800;box-shadow:0 4px 12px rgba(249,115,22,0.35)}.menu-item.just-added{animation:popIn 0.3s var(--ease)}@keyframes popIn{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
        .table-row{display:flex;gap:8px;align-items:center;margin-bottom:14px}.table-row label{font-weight:700;font-size:0.85rem;white-space:nowrap}.table-input{flex:1;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;font-size:1rem;font-weight:700;text-align:center;font-family:var(--font);transition:all 0.3s var(--ease)}.table-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}
        .cart-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--bg)}.cart-item:last-child{border-bottom:none}.cart-info{flex:1}.cart-name{font-weight:700;font-size:0.9rem;color:var(--dark-2)}.cart-price{font-size:0.78rem;color:var(--gray);margin-top:2px}.cart-controls{display:flex;align-items:center;gap:10px}.qty-btn{width:34px;height:34px;border-radius:10px;border:1.5px solid var(--primary);background:var(--white);color:var(--primary);font-size:1.1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:var(--font);transition:all 0.2s}.qty-btn:active{transform:scale(0.9);background:var(--primary-light)}.qty-btn.minus{border-color:var(--danger);color:var(--danger)}.qty-btn.minus:active{background:var(--danger-light)}.cart-qty{font-weight:800;font-size:1rem;min-width:24px;text-align:center}.cart-subtotal{font-weight:800;color:var(--primary);min-width:70px;text-align:right}
        .discount-section{display:flex;gap:8px;align-items:center;margin:10px 0;padding:12px 0;border-top:1px dashed var(--border)}.discount-section label{font-weight:700;font-size:0.85rem;white-space:nowrap}.discount-input{width:100px;padding:10px 12px;border:1.5px solid var(--border);border-radius:12px;font-size:0.95rem;font-weight:700;text-align:center;font-family:var(--font);transition:all 0.3s}.discount-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}
        .payment-methods{display:flex;gap:8px;margin:12px 0}.pay-btn{flex:1;padding:14px 8px;border:1.5px solid var(--border);border-radius:14px;background:var(--white);cursor:pointer;text-align:center;font-weight:700;font-size:0.82rem;transition:all 0.25s var(--ease);color:var(--gray);font-family:var(--font)}.pay-btn.active{border-color:var(--primary);background:var(--primary-light);color:var(--primary);box-shadow:0 0 0 3px rgba(249,115,22,0.08)}.pay-btn .pay-icon{font-size:1.4rem;display:block;margin-bottom:4px}
        .cash-calc{background:var(--bg-2);border-radius:14px;padding:16px;margin:10px 0;display:none;border:1px solid var(--border)}.cash-calc.show{display:block}.cash-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.cash-row label{font-weight:700;font-size:0.85rem}.cash-input{width:130px;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;font-size:1.15rem;font-weight:800;text-align:right;font-family:var(--font);background:var(--white)}.cash-input:focus{outline:none;border-color:var(--primary)}.change-box{text-align:center;padding:14px;border-radius:12px;font-weight:900;font-size:1.2rem}.change-box.ok{background:var(--success-light);color:var(--success-dark)}.change-box.bad{background:var(--danger-light);color:var(--danger-dark)}
        .quick-cash{display:flex;gap:6px;margin-bottom:10px;flex-wrap:wrap}.quick-cash-btn{padding:8px 14px;border:1px solid var(--border);border-radius:10px;background:var(--white);font-size:0.78rem;font-weight:700;cursor:pointer;font-family:var(--font);transition:all 0.2s;color:var(--dark-2)}.quick-cash-btn:hover{border-color:var(--primary);color:var(--primary)}.quick-cash-btn:active{transform:scale(0.95);background:var(--primary-light)}
        .pay-info-box{background:var(--bg-2);border-radius:14px;padding:24px;margin:10px 0;text-align:center;display:none;border:1px solid var(--border)}.pay-info-box.show{display:block}.pay-info-box img{max-width:220px;border-radius:14px;margin-bottom:12px;border:1px solid var(--border)}.pay-info-box .bank-detail{font-size:0.9rem;line-height:1.8}.pay-info-box .bank-detail strong{color:var(--dark)}.pay-info-box .bank-acc{font-size:1.3rem;font-weight:900;color:var(--primary);letter-spacing:2px;margin:8px 0}
        .total-bar{background:var(--dark);color:var(--white);padding:20px 22px;border-radius:var(--radius-lg);display:flex;justify-content:space-between;align-items:center;margin:14px 0}.total-label{font-size:0.9rem;font-weight:600;opacity:0.8}.total-amount{font-size:1.8rem;font-weight:900;letter-spacing:-0.5px}.subtotal-line{display:flex;justify-content:space-between;font-size:0.85rem;color:var(--gray);padding:4px 0}.discount-line{color:var(--success-dark);font-weight:600}
        .btn{padding:12px 24px;border:none;border-radius:14px;font-size:0.95rem;font-weight:700;cursor:pointer;transition:all 0.3s var(--ease);display:inline-flex;align-items:center;gap:8px;font-family:var(--font)}.btn:active{transform:scale(0.97)}.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);width:100%;justify-content:center;padding:16px;font-size:1.05rem;box-shadow:var(--shadow-primary)}.btn-primary:hover{box-shadow:0 12px 35px rgba(249,115,22,0.35)}.btn-success{background:linear-gradient(135deg,var(--success),var(--success-dark));color:var(--white)}.btn-danger{background:linear-gradient(135deg,var(--danger),var(--danger-dark));color:var(--white)}.btn-warning{background:linear-gradient(135deg,var(--warning),var(--warning-dark));color:var(--white)}.btn-info{background:linear-gradient(135deg,var(--info),var(--info-dark));color:var(--white)}.btn-outline{background:var(--white);color:var(--dark);border:1.5px solid var(--border)}.btn-ghost{background:var(--danger-light);color:var(--danger-dark)}.btn-sm{padding:8px 16px;font-size:0.78rem;border-radius:10px}.btn:disabled{opacity:0.5;cursor:not-allowed}.btn-save-order{background:linear-gradient(135deg,var(--info),var(--info-dark));color:var(--white);justify-content:center;padding:14px;font-size:0.95rem;box-shadow:0 6px 20px rgba(59,130,246,0.2)}.btn-row{display:flex;gap:10px;margin-top:14px}.btn-row .btn{flex:1}
        .shortcut-hint{font-size:0.65rem;color:var(--gray-lighter);text-align:center;margin-top:8px;font-weight:500}.shortcut-hint kbd{background:var(--bg);padding:2px 6px;border-radius:4px;font-size:0.62rem;border:1px solid var(--border);font-family:var(--font)}
        .form-group{margin-bottom:14px}.form-group label{display:block;margin-bottom:6px;font-weight:700;font-size:0.82rem;color:var(--dark-3)}.form-input{width:100%;padding:14px 16px;border:1.5px solid var(--border);border-radius:14px;font-size:0.95rem;transition:all 0.3s var(--ease);font-family:var(--font);background:var(--white)}.form-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}.form-row{display:flex;gap:10px}.form-row .form-group{flex:1}select.form-input{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2394a3b8' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;padding-right:36px}
        .order-card{background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius-lg);padding:18px;margin-bottom:12px;border-left:4px solid var(--success);box-shadow:var(--shadow-xs);transition:all 0.3s var(--ease)}.order-card:hover{box-shadow:var(--shadow)}.order-card.pending{border-left-color:var(--warning)}.order-card.cancelled{border-left-color:var(--danger);opacity:0.6}.order-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}.order-num{font-weight:900;font-size:1.2rem;color:var(--primary);letter-spacing:-0.5px}.order-id{font-size:0.68rem;color:var(--gray-light)}.order-time{font-size:0.78rem;color:var(--gray)}.order-staff{font-size:0.72rem;color:var(--gray-light)}.order-badge{padding:5px 14px;border-radius:var(--radius-full);font-size:0.68rem;font-weight:700;text-transform:uppercase;letter-spacing:0.3px}.badge-done{background:var(--success-light);color:var(--success-dark)}.badge-pending{background:#fef3c7;color:var(--warning-dark)}.badge-cancel{background:var(--danger-light);color:var(--danger-dark)}.order-items{font-size:0.82rem;color:var(--gray);margin-bottom:10px;line-height:1.6}.order-bottom{display:flex;justify-content:space-between;align-items:center}.order-total{font-weight:900;font-size:1.1rem;color:var(--primary)}.order-discount{font-size:0.72rem;color:var(--success-dark);font-weight:600}.order-pay{font-size:0.72rem;color:var(--gray-light)}.order-actions{display:flex;gap:6px;margin-top:10px}
        .order-filter{display:flex;gap:4px;margin:12px 0;background:var(--bg);padding:4px;border-radius:12px}.order-filter-btn{flex:1;padding:8px;border:none;border-radius:10px;background:transparent;font-size:0.78rem;font-weight:700;cursor:pointer;color:var(--gray);font-family:var(--font);transition:all 0.2s}.order-filter-btn.active{background:var(--white);color:var(--primary);box-shadow:var(--shadow-xs)}
        .sales-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px}.stat-card{background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius-lg);padding:22px;text-align:center;box-shadow:var(--shadow-xs);transition:all 0.3s var(--ease)}.stat-card:hover{box-shadow:var(--shadow);transform:translateY(-2px)}.stat-value{font-size:1.6rem;font-weight:900;color:var(--primary);letter-spacing:-0.5px}.stat-label{font-size:0.75rem;color:var(--gray);font-weight:600;margin-top:4px}.stat-trend{font-size:0.7rem;font-weight:700;margin-top:6px;display:inline-flex;align-items:center;gap:3px;padding:3px 10px;border-radius:20px}.stat-trend.up{background:var(--success-light);color:var(--success-dark)}.stat-trend.down{background:var(--danger-light);color:var(--danger-dark)}.stat-trend.neutral{background:var(--bg);color:var(--gray)}
        .stat-card.hero-stat{grid-column:span 2;background:linear-gradient(135deg,var(--primary),#ea580c,#dc2626);border:none;color:var(--white);position:relative;overflow:hidden;padding:28px}.stat-card.hero-stat::before{content:'';position:absolute;top:-40%;right:-20%;width:200px;height:200px;background:radial-gradient(circle,rgba(255,255,255,0.12),transparent 70%);border-radius:50%}.stat-card.hero-stat::after{content:'';position:absolute;bottom:-30%;left:-10%;width:150px;height:150px;background:radial-gradient(circle,rgba(255,255,255,0.08),transparent 70%);border-radius:50%}.stat-card.hero-stat .stat-value{font-size:2.8rem;color:var(--white);position:relative;z-index:1}.stat-card.hero-stat .stat-label{color:rgba(255,255,255,0.85);position:relative;z-index:1;font-size:0.82rem}.stat-card.hero-stat .stat-trend{background:rgba(255,255,255,0.2);color:var(--white)}
        .date-nav{display:flex;align-items:center;gap:10px;margin-bottom:14px}.date-nav-btn{width:40px;height:40px;border-radius:12px;border:1.5px solid var(--border);background:var(--white);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all 0.2s;color:var(--dark)}.date-nav-btn:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-light)}.date-nav-btn:active{transform:scale(0.95)}.date-nav-input{flex:1}.date-nav-today{padding:8px 16px;border-radius:12px;border:1.5px solid var(--primary);background:var(--primary-light);color:var(--primary);font-size:0.78rem;font-weight:700;cursor:pointer;font-family:var(--font);transition:all 0.2s;white-space:nowrap}.date-nav-today:hover{background:var(--primary);color:var(--white)}
        .report-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px}.report-tabs{display:flex;gap:4px;background:var(--bg);padding:4px;border-radius:14px;flex:1;max-width:360px}.report-tab{flex:1;padding:10px;border:none;border-radius:12px;background:transparent;text-align:center;font-weight:700;font-size:0.82rem;cursor:pointer;color:var(--gray);font-family:var(--font);transition:all 0.25s var(--ease)}.report-tab.active{background:var(--white);color:var(--primary);box-shadow:var(--shadow-sm)}
        .btn-export{padding:8px 16px;border-radius:12px;border:1.5px solid var(--border);background:var(--white);color:var(--dark-2);font-size:0.78rem;font-weight:700;cursor:pointer;font-family:var(--font);display:flex;align-items:center;gap:6px;transition:all 0.2s}.btn-export:hover{border-color:var(--success-dark);color:var(--success-dark);background:var(--success-light)}
        .today-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(249,115,22,0.08);padding:8px 16px;border-radius:var(--radius-full);font-size:0.82rem;font-weight:700;color:var(--primary);margin-bottom:14px;border:1px solid rgba(249,115,22,0.12)}
        .pay-stats{display:flex;gap:10px;margin-bottom:14px}.pay-stat{flex:1;background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius);padding:16px 10px;text-align:center;box-shadow:var(--shadow-xs);transition:all 0.2s}.pay-stat:hover{box-shadow:var(--shadow)}.pay-stat .ps-icon{font-size:1.4rem}.pay-stat .ps-val{font-weight:800;font-size:0.95rem;margin-top:6px;color:var(--dark)}.pay-stat .ps-count{font-size:0.68rem;color:var(--gray-light);font-weight:600;margin-top:2px}.pay-stat .ps-label{font-size:0.68rem;color:var(--gray-light);font-weight:600;margin-top:2px}.pay-stat .ps-bar{height:4px;background:var(--bg);border-radius:4px;margin-top:8px;overflow:hidden}.pay-stat .ps-bar-fill{height:100%;border-radius:4px;transition:width 0.6s var(--ease)}
        .chart-container{position:relative;padding:10px 0}.chart-bars{display:flex;align-items:flex-end;gap:6px;height:180px;padding:10px 0}.chart-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;height:100%;justify-content:flex-end;cursor:pointer;position:relative}.chart-bar{width:100%;background:linear-gradient(to top,var(--primary),#fb923c);border-radius:10px 10px 4px 4px;min-height:4px;transition:all 0.4s var(--ease)}.chart-bar:hover{filter:brightness(1.1);transform:scaleX(1.05)}.chart-bar-label{font-size:0.62rem;color:var(--gray);font-weight:600;margin-top:8px;text-align:center;line-height:1.3}.chart-bar-value{font-size:0.58rem;color:var(--dark);font-weight:700;margin-bottom:4px;opacity:0;transition:opacity 0.2s}.chart-bar-wrap:hover .chart-bar-value{opacity:1}.chart-bar-wrap.today .chart-bar{background:linear-gradient(to top,#ea580c,#f97316,#fb923c);box-shadow:0 4px 15px rgba(249,115,22,0.3)}.chart-bar-wrap.today .chart-bar-label{color:var(--primary);font-weight:800}
        .hourly-chart{display:flex;align-items:flex-end;gap:3px;height:120px;padding:8px 0}.hourly-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;height:100%;justify-content:flex-end;min-width:0}.hourly-bar{width:100%;border-radius:6px 6px 2px 2px;min-height:2px;transition:height 0.4s var(--ease)}.hourly-bar.peak{background:linear-gradient(to top,#ea580c,#f97316)}.hourly-bar.normal{background:linear-gradient(to top,#fdba74,#fb923c);opacity:0.6}.hourly-bar.low{background:var(--gray-lighter)}.hourly-label{font-size:0.5rem;color:var(--gray-light);font-weight:600;margin-top:4px;transform:rotate(-45deg);white-space:nowrap}.peak-badge{display:inline-flex;align-items:center;gap:4px;background:var(--primary-light);color:var(--primary-dark);padding:6px 14px;border-radius:20px;font-size:0.75rem;font-weight:700;margin-top:10px;border:1px solid rgba(249,115,22,0.15)}
        .donut-container{display:flex;align-items:center;gap:24px;padding:10px 0}.donut-chart{width:150px;height:150px;border-radius:50%;position:relative;flex-shrink:0}.donut-hole{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:var(--white);border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;box-shadow:0 0 20px rgba(0,0,0,0.05)}.donut-hole-val{font-size:1.1rem;font-weight:900;color:var(--dark)}.donut-hole-label{font-size:0.6rem;color:var(--gray);font-weight:600}.pie-legend{flex:1}.pie-legend-item{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:0.82rem}.pie-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}.pie-legend-name{flex:1;font-weight:600;color:var(--dark-2)}.pie-legend-val{font-weight:800;color:var(--primary);font-size:0.85rem}.pie-legend-pct{font-size:0.7rem;color:var(--gray);font-weight:600;margin-left:4px}
        .cal-heatmap{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin:10px 0}.cal-day-header{font-size:0.6rem;color:var(--gray-light);font-weight:700;text-align:center;padding:4px 0}.cal-day{aspect-ratio:1;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:0.65rem;font-weight:700;cursor:pointer;transition:all 0.2s;border:1px solid transparent;position:relative}.cal-day:hover{transform:scale(1.1);z-index:2;box-shadow:var(--shadow)}.cal-day .cal-date{font-size:0.7rem;font-weight:800}.cal-day .cal-val{font-size:0.5rem;font-weight:600;margin-top:1px}.cal-day.empty{background:transparent;cursor:default}.cal-day.empty:hover{transform:none;box-shadow:none}.cal-day.level-0{background:var(--bg);color:var(--gray-light)}.cal-day.level-1{background:#ffedd5;color:var(--primary-dark)}.cal-day.level-2{background:#fed7aa;color:var(--primary-dark)}.cal-day.level-3{background:#fdba74;color:var(--primary-dark)}.cal-day.level-4{background:#fb923c;color:var(--white)}.cal-day.level-5{background:var(--primary);color:var(--white)}.cal-day.today-mark{border:2px solid var(--primary-dark);box-shadow:0 0 0 2px rgba(249,115,22,0.15)}.cal-legend{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:12px;font-size:0.68rem;color:var(--gray)}.cal-legend-box{width:14px;height:14px;border-radius:4px}
        .summary-row{display:flex;gap:10px;margin:14px 0;padding:14px;background:var(--bg-2);border-radius:14px;border:1px solid var(--border)}.summary-item{flex:1;text-align:center}.summary-item .si-val{font-weight:900;font-size:1rem;color:var(--dark)}.summary-item .si-label{font-size:0.68rem;color:var(--gray);font-weight:600;margin-top:2px}.summary-divider{width:1px;background:var(--border)}
        .top-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--bg)}.top-item:last-child{border-bottom:none}.top-left{display:flex;align-items:center;gap:12px}.top-rank{width:32px;height:32px;border-radius:10px;background:var(--primary);color:var(--white);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.8rem}.top-rank.r1{background:linear-gradient(135deg,#f59e0b,#d97706)}.top-rank.r2{background:linear-gradient(135deg,#94a3b8,#64748b)}.top-rank.r3{background:linear-gradient(135deg,#f97316,#ea580c)}.top-info{flex:1}.top-name{font-weight:700;font-size:0.88rem}.top-rev{font-size:0.72rem;color:var(--gray)}.top-right{text-align:right}.top-qty{font-weight:800;color:var(--primary)}.top-bar-bg{width:80px;height:6px;background:var(--bg);border-radius:6px;margin-top:4px}.top-bar-fill{height:100%;background:linear-gradient(90deg,var(--primary),#fb923c);border-radius:6px;transition:width 0.6s var(--ease)}
        .menu-manage-item{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--bg-2);border-radius:14px;margin-bottom:8px;border:1px solid var(--border);transition:all 0.2s}.menu-manage-item:hover{border-color:rgba(249,115,22,0.2);box-shadow:var(--shadow-xs)}.mm-info{flex:1}.mm-name{font-weight:700;font-size:0.9rem}.mm-cat{font-size:0.72rem;color:var(--gray-light);font-weight:600}.mm-price{color:var(--primary);font-weight:800}.mm-actions{display:flex;gap:6px}
        .staff-item{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--bg-2);border-radius:14px;margin-bottom:8px;border:1px solid var(--border)}.staff-item .si-info{flex:1}.staff-item .si-name{font-weight:700;font-size:0.9rem}.staff-item .si-role{font-size:0.72rem;color:var(--gray-light);font-weight:600}.staff-item .si-pin{font-size:0.75rem;color:var(--gray);font-family:monospace}
        .receipt{background:var(--white);padding:28px;font-family:'Courier New',monospace;font-size:0.82rem;max-width:320px;margin:0 auto;width:100%}.receipt-header{text-align:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px dashed var(--dark)}.receipt-shop{font-weight:700;font-size:1.1rem}.receipt-addr{font-size:0.75rem;color:var(--gray)}.receipt-line{display:flex;justify-content:space-between;padding:3px 0;gap:8px}.receipt-line span:first-child{flex:1;word-break:break-word}.receipt-line span:last-child{white-space:nowrap}.receipt-divider{border-top:1px dashed var(--dark);margin:8px 0}.receipt-total .receipt-line{font-weight:700;font-size:1.1rem}.receipt-footer{text-align:center;margin-top:16px;font-size:0.78rem;color:var(--gray)}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,0.5);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:500;align-items:center;justify-content:center;padding:16px}.modal-overlay.show{display:flex}.modal{background:var(--white);border-radius:var(--radius-xl);width:100%;max-width:500px;max-height:85vh;overflow-y:auto;padding:28px;animation:modalIn 0.35s var(--ease);box-shadow:var(--shadow-xl)}@keyframes modalIn{from{transform:scale(0.95) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}.modal-title{font-size:1.15rem;font-weight:800;margin-bottom:20px}.modal-actions{display:flex;gap:10px;margin-top:20px}.modal-actions .btn{flex:1;justify-content:center}
        .toast-wrap{position:fixed;top:70px;right:16px;z-index:1000}.toast{background:var(--dark);color:var(--white);padding:14px 22px;border-radius:14px;margin-bottom:8px;animation:slideIn 0.35s var(--ease),fadeOut 0.3s 2.7s forwards;font-size:0.85rem;font-weight:600;box-shadow:var(--shadow-lg);max-width:300px}.toast.success{background:var(--success-dark)}.toast.error{background:var(--danger-dark)}@keyframes slideIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes fadeOut{to{opacity:0;transform:translateY(-10px)}}
        .empty{text-align:center;padding:40px 20px;color:var(--gray)}.empty-icon{font-size:2.5rem;margin-bottom:10px}.loading{text-align:center;padding:30px;color:var(--gray)}.spinner{border:3px solid var(--bg);border-top-color:var(--primary);border-radius:50%;width:36px;height:36px;animation:spin 0.8s linear infinite;margin:0 auto 12px}@keyframes spin{to{transform:rotate(360deg)}}
        .cart-empty{text-align:center;padding:40px 20px;color:var(--gray-light)}.cart-empty-icon{font-size:3rem;margin-bottom:12px;opacity:0.5}.cart-empty-text{font-size:0.88rem;font-weight:600}.cart-empty-hint{font-size:0.78rem;margin-top:6px;color:var(--gray-lighter)}
        
        /* ============================================
           RESPONSIVE - MOBILE FIRST
           ============================================ */
        @media(max-width:600px){
            body{font-size:14px;overflow-x:hidden;width:100%}
            .header{padding:12px 14px;flex-wrap:wrap;gap:8px}
            .header-left{gap:8px;flex:1;min-width:0}
            .header-logo{font-size:0.95rem;white-space:nowrap}
            .header-staff{padding:4px 10px;font-size:0.7rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px}
            .header-right{gap:6px;flex-wrap:wrap}
            .header-counter,.header-time{font-size:0.72rem;padding:4px 10px}
            .btn-logout{padding:5px 12px;font-size:0.7rem}
            .nav-tabs{padding:2px;gap:1px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
            .nav-tabs::-webkit-scrollbar{display:none}
            .nav-tab{padding:8px 4px 6px;font-size:0.62rem;min-width:50px;flex-shrink:0}
            .nav-tab .tab-icon{font-size:1rem;margin-bottom:1px}
            .tab-content{padding:12px;padding-bottom:70px}
            .menu-grid{grid-template-columns:repeat(3,1fr)!important;gap:8px}
            .menu-item{padding:10px 6px;min-width:0}
            .menu-item .item-cat{font-size:0.58rem;margin-bottom:2px}
            .menu-item .item-name{font-size:0.75rem;line-height:1.1;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;word-break:break-word}
            .menu-item .item-price{font-size:0.85rem;margin-top:3px}
            .menu-item .item-badge{width:22px;height:22px;font-size:0.7rem;top:-6px;right:-6px}
            .order-layout{flex-direction:column;gap:12px}
            .order-left,.order-right{width:100%;position:static;max-height:none}
            .order-right .card{max-height:none}
            .cart-scroll{max-height:none;overflow-y:visible}
            .search-bar input{padding:12px 16px 12px 40px;font-size:0.85rem}
            .search-bar::before{left:14px;font-size:0.85rem}
            .category-filter{gap:6px;margin-bottom:12px;padding-bottom:6px}
            .cat-chip{padding:7px 16px;font-size:0.75rem;white-space:nowrap}
            .cart-item{flex-wrap:wrap;gap:8px;padding:10px 0}
            .cart-info{flex:1;min-width:120px}
            .cart-name{font-size:0.82rem}
            .cart-price{font-size:0.72rem}
            .cart-controls{gap:8px}
            .qty-btn{width:30px;height:30px;font-size:1rem}
            .cart-qty{font-size:0.9rem;min-width:20px}
            .cart-subtotal{font-size:0.9rem;min-width:auto;flex-basis:100%;text-align:right;margin-top:-4px}
            .table-row{flex-wrap:wrap;gap:6px;margin-bottom:12px}
            .table-row label{font-size:0.78rem;width:100%}
            .table-input{padding:10px 12px;font-size:0.9rem}
            .discount-section{flex-wrap:wrap;gap:6px;padding:10px 0}
            .discount-section label{font-size:0.78rem;width:100%}
            .discount-input{width:100%;padding:10px 12px;font-size:0.9rem}
            .payment-methods{gap:6px;flex-wrap:wrap}
            .pay-btn{flex:1;min-width:calc(33.333% - 4px);padding:12px 6px;font-size:0.75rem}
            .pay-btn .pay-icon{font-size:1.2rem;margin-bottom:3px}
            .cash-calc{padding:12px}
            .cash-row{flex-wrap:wrap;gap:6px;margin-bottom:8px}
            .cash-row label{font-size:0.78rem;width:100%}
            .cash-input{width:100%;padding:10px 12px;font-size:1rem}
            .quick-cash{gap:5px;margin-bottom:8px}
            .quick-cash-btn{padding:7px 12px;font-size:0.72rem}
            .total-bar{padding:16px 18px;flex-wrap:wrap;gap:6px}
            .total-label{font-size:0.8rem}
            .total-amount{font-size:1.5rem;width:100%;text-align:left;margin-top:4px}
            .btn-row{flex-wrap:wrap;gap:8px}
            .btn-row .btn{flex:1;min-width:100%;padding:13px;font-size:0.88rem}
            .btn-primary,.btn-save-order{padding:14px;font-size:0.95rem}
            .order-filter{gap:3px;flex-wrap:wrap}
            .order-filter-btn{padding:7px;font-size:0.72rem;flex:1;min-width:calc(50% - 2px)}
            .order-card{padding:14px;margin-bottom:10px}
            .order-header{flex-wrap:wrap;gap:8px}
            .order-num{font-size:1rem}
            .order-id{font-size:0.62rem}
            .order-time,.order-staff{font-size:0.7rem}
            .order-badge{padding:4px 12px;font-size:0.65rem;margin-top:6px}
            .order-items{font-size:0.75rem;margin-bottom:8px}
            .order-bottom{flex-wrap:wrap;gap:8px}
            .order-total{font-size:1rem}
            .order-discount,.order-pay{font-size:0.68rem}
            .order-actions{width:100%;gap:5px;margin-top:8px;justify-content:flex-end}
            .order-actions .btn{flex:0;padding:6px 12px;font-size:0.7rem}
            .report-header{flex-direction:column;align-items:stretch;gap:10px}
            .report-tabs{max-width:100%}
            .report-tab{padding:9px;font-size:0.75rem}
            .btn-export{width:100%;justify-content:center;padding:10px}
            .sales-grid{grid-template-columns:1fr;gap:10px}
            .stat-card{padding:18px}
            .stat-value{font-size:1.4rem}
            .stat-card.hero-stat .stat-value{font-size:2.2rem}
            .stat-label{font-size:0.72rem}
            .stat-trend{font-size:0.68rem;padding:3px 8px}
            .date-nav{gap:6px;flex-wrap:wrap}
            .date-nav-btn{width:36px;height:36px;font-size:0.9rem}
            .date-nav-input{flex:1;min-width:140px}
            .date-nav-today{padding:7px 14px;font-size:0.72rem}
            .pay-stats{gap:8px;flex-wrap:wrap}
            .pay-stat{flex:1;min-width:calc(50% - 4px);padding:14px 8px}
            .ps-icon{font-size:1.2rem}
            .ps-val{font-size:0.85rem}
            .ps-count,.ps-label{font-size:0.65rem}
            .chart-bars{gap:4px;height:150px;padding:8px 0}
            .chart-bar-label{font-size:0.58rem}
            .chart-bar-value{font-size:0.55rem}
            .hourly-chart{gap:2px;height:100px}
            .hourly-label{font-size:0.45rem;margin-top:3px}
            .donut-container{flex-direction:column;gap:16px;align-items:center}
            .donut-chart{width:140px;height:140px}
            .donut-hole{width:70px;height:70px}
            .donut-hole-val{font-size:1rem}
            .donut-hole-label{font-size:0.58rem}
            .pie-legend-item{font-size:0.75rem;padding:5px 0}
            .pie-legend-val{font-size:0.8rem}
            .pie-legend-pct{font-size:0.68rem}
            .cal-day{font-size:0.62rem;min-height:35px}
            .cal-day .cal-date{font-size:0.68rem}
            .cal-day .cal-val{display:none}
            .cal-day-header{font-size:0.58rem;padding:3px 0}
            .cal-legend{font-size:0.65rem;flex-wrap:wrap;gap:6px}
            .cal-legend-box{width:12px;height:12px}
            .top-item{padding:10px 0;flex-wrap:wrap}
            .top-left{gap:10px;flex:1}
            .top-rank{width:28px;height:28px;font-size:0.75rem}
            .top-name{font-size:0.8rem}
            .top-rev{font-size:0.68rem}
            .top-right{width:100%;margin-top:8px}
            .top-qty{font-size:0.85rem}
            .top-bar-bg{width:100%;margin-top:6px}
            .summary-row{flex-wrap:wrap;gap:8px;padding:12px}
            .summary-item{flex:1;min-width:calc(50% - 4px)}
            .summary-divider{display:none}
            .si-val{font-size:0.9rem}
            .si-label{font-size:0.65rem}
            .menu-manage-item{padding:12px;flex-wrap:wrap;gap:8px}
            .mm-info{flex:1;min-width:150px}
            .mm-name{font-size:0.82rem}
            .mm-cat,.mm-price{font-size:0.72rem}
            .mm-actions{gap:5px}
            .staff-item{padding:12px;flex-wrap:wrap;gap:8px}
            .si-name{font-size:0.82rem}
            .si-role,.si-pin{font-size:0.7rem}
            .form-row{flex-direction:column}
            .form-group{margin-bottom:12px}
            .form-group label{font-size:0.78rem;margin-bottom:5px}
            .form-input{padding:12px 14px;font-size:0.88rem}
            .modal{padding:20px;max-height:90vh}
            .modal-title{font-size:1rem;margin-bottom:16px}
            .modal-actions{flex-wrap:wrap;gap:8px}
            .modal-actions .btn{flex:1;min-width:calc(50% - 4px);padding:12px;font-size:0.88rem}
            .receipt{padding:20px 16px;font-size:0.78rem}
            .receipt-shop{font-size:1rem}
            .receipt-addr{font-size:0.7rem}
            .receipt-line{font-size:0.75rem;gap:6px}
            .receipt-total .receipt-line{font-size:1rem}
            .receipt-footer{font-size:0.72rem;margin-top:14px}
            .card{padding:16px;margin-bottom:12px;border-radius:14px}
            .card-title{font-size:0.88rem;margin-bottom:14px;gap:6px}
            .btn{padding:11px 20px;font-size:0.88rem}
            .btn-sm{padding:7px 14px;font-size:0.72rem}
            .shortcut-hint{display:none}
            .today-badge{font-size:0.75rem;padding:7px 14px}
            .peak-badge{font-size:0.7rem;padding:5px 12px}
            .pay-info-box img{max-width:180px}
            .bank-acc{font-size:1.1rem}
            .bank-detail{font-size:0.82rem}
            .login-card{padding:36px 24px;max-width:360px}
            .login-logo{font-size:1.8rem}
            .login-shop-name{font-size:0.95rem;padding:12px 16px}
            .pin-input{padding:16px;font-size:1.3rem;letter-spacing:10px}
            .btn-login{padding:16px;font-size:0.95rem}
        }
        
        @media(min-width:601px) and (max-width:868px){
            .menu-grid{grid-template-columns:repeat(4,1fr)!important;gap:10px}
            .order-layout{flex-direction:column}
            .order-right{width:100%;position:static;max-height:none}
            .sales-grid{grid-template-columns:repeat(2,1fr)}
            .stat-card.hero-stat{grid-column:span 2}
        }
        
        @media(min-width:869px){
            .order-layout{flex-direction:row}
            .menu-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px}
        }
        
        @media(min-width:1100px){
            .menu-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}
            .order-right{width:420px}
        }
        
        @media(max-width:900px) and (orientation:landscape){
            .order-layout{flex-direction:row}
            .order-left{flex:1}
            .order-right{width:350px;position:sticky;top:100px;max-height:calc(100vh - 120px)}
            .cart-scroll{overflow-y:auto}
        }
        
        @media print{
            body *{visibility:hidden}
            .receipt,.receipt *{visibility:visible}
            .receipt{position:absolute;top:0;left:0}
        }
        /* QUICK FIX - Cart Overflow */
.cart-item{
    display:flex!important;
    flex-wrap:wrap!important;
    gap:8px!important;
    align-items:center!important;
}

.cart-info{
    flex:1 1 auto!important;
    min-width:0!important;
    max-width:100%!important;
}

.cart-name{
    white-space:nowrap!important;
    overflow:hidden!important;
    text-overflow:ellipsis!important;
    max-width:100%!important;
    display:block!important;
}

.cart-controls{
    flex-shrink:0!important;
}

.cart-subtotal{
    flex-shrink:0!important;
    white-space:nowrap!important;
}

@media(max-width:600px){
    .cart-info{
        flex:1 1 100%!important;
        display:flex!important;
        justify-content:space-between!important;
        align-items:center!important;
    }
    
    .cart-name{
        flex:1!important;
        margin-right:8px!important;
    }
    
    .cart-price{
        flex-shrink:0!important;
        margin-top:0!important;
    }
}

#cartCard, .order-right .card{
    overflow:hidden!important;
}

.cart-scroll{
    overflow-x:hidden!important;
}
    </style>
</head>
<body>
<div class="login-screen" id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><span>POS</span><span>Kedai</span></div>
        <p class="login-subtitle">üçΩÔ∏è Sistem POS Kedai Makanan</p>
        <div class="login-shop-name" id="loginShopName">Memuatkan...</div>
        <input type="password" class="pin-input" id="pinInput" placeholder="PIN" maxlength="6" inputmode="numeric" onkeyup="if(event.key==='Enter')doLogin()">
        <button class="btn-login" onclick="doLogin()">üîì Masuk</button>
        <p class="login-skip" onclick="skipLogin()">Masuk tanpa PIN ‚Üí</p>
    </div>
</div>

<div class="app-container" id="appContainer">
    <div class="offline-banner" id="offBanner">‚ö†Ô∏è Tiada internet.</div>
    
    <div class="header">
        <div class="header-left">
            <span class="header-logo"><span>POS</span><span>Kedai</span></span>
            <span class="header-staff" id="staffBadge">üë§ Admin</span>
        </div>
        <div class="header-right">
            <span class="offline-dot" id="offDot"></span>
            <span class="header-counter" id="orderCounter">#0</span>
            <span class="header-time" id="clock"></span>
            <button class="btn-logout" onclick="doLogout()">Keluar</button>
        </div>
    </div>
    
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="go('order',this)"><span class="tab-icon">üõí</span>Pesanan</button>
        <button class="nav-tab" onclick="go('list',this)"><span class="tab-icon">üìã</span>Senarai</button>
        <button class="nav-tab" onclick="go('sales',this)"><span class="tab-icon">üìä</span>Jualan</button>
        <button class="nav-tab" onclick="go('menu',this)"><span class="tab-icon">üìù</span>Menu</button>
        <button class="nav-tab" onclick="go('settings',this)" id="tabSettings"><span class="tab-icon">‚öôÔ∏è</span>Tetapan</button>
    </div>
    
    <div class="toast-wrap" id="toastWrap"></div>
    
    <div class="tab-content active" id="tab-order">
        <div class="order-layout">
            <div class="order-left">
                <div class="search-bar">
                    <input type="text" id="menuSearch" placeholder="Cari menu...">
                </div>
                <div class="category-filter" id="catFilter"></div>
                <div class="menu-grid" id="menuGrid">
                    <div class="loading"><div class="spinner"></div>Memuatkan menu...</div>
                </div>
            </div>
            <div class="order-right">
                <div class="card" id="cartCard">
                    <div class="card-title">
                        üõí Troli 
                        <span id="cartCount" style="background:var(--primary);color:white;padding:2px 10px;border-radius:20px;font-size:0.75rem;margin-left:6px">0</span>
                        <span style="margin-left:auto">
                            <button class="btn btn-ghost btn-sm" onclick="clearCart()">üóëÔ∏è Kosong</button>
                        </span>
                    </div>
                    
                    <div id="cartEmpty" class="cart-empty">
                        <div class="cart-empty-icon">üõí</div>
                        <div class="cart-empty-text">Troli kosong</div>
                        <div class="cart-empty-hint">Tekan menu untuk tambah</div>
                    </div>
                    
                    <div id="cartContent" style="display:none">
                        <div class="cart-scroll" id="cartScroll">
                            <div class="table-row">
                                <label>ü™ë Meja:</label>
                                <input type="text" class="table-input" id="tableNo" placeholder="-" maxlength="10">
                            </div>
                            
                            <div id="cartList"></div>
                            
                            <div class="discount-section">
                                <label>üè∑Ô∏è Diskaun (RM):</label>
                                <input type="number" class="discount-input" id="discountAmt" value="0" min="0" step="0.50" oninput="renderCart()">
                            </div>
                            
                            <div id="summaryLines"></div>
                        </div>
                        
                        <div class="cart-footer">
                            <div class="total-bar">
                                <span class="total-label">JUMLAH</span>
                                <span class="total-amount">RM <span id="cartTotal">0.00</span></span>
                            </div>
                            
                            <div style="font-weight:800;font-size:0.9rem;margin:12px 0 8px">üí∞ Cara Bayar</div>
                            <div class="payment-methods">
                                <button class="pay-btn active" onclick="pickPay('cash',this)"><span class="pay-icon">üíµ</span>Tunai</button>
                                <button class="pay-btn" onclick="pickPay('qr',this)"><span class="pay-icon">üì±</span>QR</button>
                                <button class="pay-btn" onclick="pickPay('transfer',this)"><span class="pay-icon">üè¶</span>Transfer</button>
                            </div>
                            
                            <div class="cash-calc show" id="cashCalc">
                                <div class="quick-cash" id="quickCash"></div>
                                <div class="cash-row">
                                    <label>üíµ Diterima:</label>
                                    <input type="number" class="cash-input" id="cashIn" oninput="calcChange()" placeholder="0.00" step="0.50">
                                </div>
                                <div class="change-box" id="changeBox">-</div>
                            </div>
                            
                            <div class="pay-info-box" id="qrBox">
                                <p style="font-weight:700;margin-bottom:10px">üì± Scan QR</p>
                                <div id="qrContent"><p style="color:var(--gray)">QR belum disetup.</p></div>
                            </div>
                            
                            <div class="pay-info-box" id="transferBox">
                                <p style="font-weight:700;margin-bottom:10px">üè¶ Transfer</p>
                                <div id="transferContent"><p style="color:var(--gray)">Bank belum disetup.</p></div>
                            </div>
                            
                            <div class="btn-row">
                                <button class="btn btn-save-order" onclick="saveOrderPending()" id="btnSave">üíæ Simpan</button>
                                <button class="btn btn-primary" onclick="submitOrder()" id="btnSubmit">‚úÖ Selesai & Bayar</button>
                            </div>
                            
                            <div class="shortcut-hint"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> bayar cepat</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="tab-list">
        <div class="card">
            <div class="card-title">üìã Senarai Pesanan</div>
            <div class="form-group">
                <input type="date" class="form-input" id="orderDate" onchange="loadOrders()">
            </div>
            <div class="order-filter">
                <button class="order-filter-btn active" onclick="filterOrders('all',this)">Semua</button>
                <button class="order-filter-btn" onclick="filterOrders('completed',this)">‚úÖ Selesai</button>
                <button class="order-filter-btn" onclick="filterOrders('pending',this)">‚è≥ Belum</button>
                <button class="order-filter-btn" onclick="filterOrders('cancelled',this)">‚ùå Batal</button>
            </div>
        </div>
        <div id="ordersList">
            <div class="loading"><div class="spinner"></div>Memuatkan...</div>
        </div>
    </div>
    
    <div class="tab-content" id="tab-sales">
        <div class="card">
            <div class="report-header">
                <div class="report-tabs">
                    <button class="report-tab active" onclick="switchReport('daily',this)">üìÖ Harian</button>
                    <button class="report-tab" onclick="switchReport('weekly',this)">üìä Mingguan</button>
                    <button class="report-tab" onclick="switchReport('monthly',this)">üìÜ Bulanan</button>
                </div>
                <div>
                    <button class="btn-export" onclick="exportSalesCSV()">üì• Export</button>
                </div>
            </div>
            <div id="reportDatePicker"></div>
        </div>
        <div id="salesDash"></div>
    </div>
    
    <div class="tab-content" id="tab-menu">
        <div class="card">
            <div class="card-title">‚ûï Tambah Menu Baru</div>
            <div class="form-row">
                <div class="form-group">
                    <label>Nama</label>
                    <input type="text" class="form-input" id="newName" placeholder="Nasi Lemak">
                </div>
                <div class="form-group" style="max-width:110px">
                    <label>Harga (RM)</label>
                    <input type="number" class="form-input" id="newPrice" placeholder="5.00" step="0.50" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select class="form-input" id="newCat">
                    <option value="Makanan">üçö Makanan</option>
                    <option value="Minuman">ü•§ Minuman</option>
                    <option value="Kuih">üç∞ Kuih</option>
                    <option value="Tambahan">‚ûï Tambahan</option>
                    <option value="Set">üç± Set</option>
                    <option value="Lain-lain">üì¶ Lain-lain</option>
                </select>
            </div>
            <button class="btn btn-success" style="width:100%;justify-content:center" onclick="addMenu()">‚ûï Tambah</button>
        </div>
        
        <div class="card">
            <div class="card-title">üìã Senarai Menu</div>
            <div id="menuManage">
                <div class="loading"><div class="spinner"></div>Memuatkan...</div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="tab-settings">
        <div class="card">
            <div class="card-title">üë• Urus Staff</div>
            <div class="form-row">
                <div class="form-group">
                    <label>PIN</label>
                    <input type="text" class="form-input" id="newStaffPin" placeholder="1234" maxlength="6" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label>Nama</label>
                    <input type="text" class="form-input" id="newStaffName" placeholder="Ahmad">
                </div>
                <div class="form-group" style="max-width:110px">
                    <label>Peranan</label>
                    <select class="form-input" id="newStaffRole">
                        <option value="staff">Staff</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
            </div>
            <button class="btn btn-success" style="width:100%;justify-content:center" onclick="addStaff()">‚ûï Tambah Staff</button>
            <div style="margin-top:14px" id="staffList">
                <div class="loading"><div class="spinner"></div>Memuatkan...</div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">üì± QR Payment</div>
            <div class="form-group">
                <label>Upload QR</label>
                <input type="file" class="form-input" id="qrUpload" accept="image/*" onchange="previewQR(this)">
            </div>
            <div id="qrPreview" style="text-align:center;margin:10px 0"></div>
            <button class="btn btn-info" style="width:100%;justify-content:center" onclick="saveQR()">üíæ Simpan QR</button>
        </div>
        
        <div class="card">
            <div class="card-title">üè¶ Maklumat Transfer</div>
            <div class="form-group">
                <label>Nama Bank</label>
                <input type="text" class="form-input" id="setBankName" placeholder="Maybank">
            </div>
            <div class="form-group">
                <label>No. Akaun</label>
                <input type="text" class="form-input" id="setBankAcc" placeholder="1234567890">
            </div>
            <div class="form-group">
                <label>Nama Pemilik</label>
                <input type="text" class="form-input" id="setBankHolder" placeholder="Ahmad">
            </div>
            <button class="btn btn-info" style="width:100%;justify-content:center" onclick="saveBankInfo()">üíæ Simpan</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="editModal">
    <div class="modal">
        <div class="modal-title">‚úèÔ∏è Edit Pesanan <span id="editId"></span></div>
        <div id="editItems"></div>
        <div class="total-bar">
            <span class="total-label">JUMLAH</span>
            <span class="total-amount">RM <span id="editTotal">0.00</span></span>
        </div>
        <div class="modal-actions">
            <button class="btn btn-outline" onclick="closeM('editModal')">Batal</button>
            <button class="btn btn-success" onclick="saveEdit()">üíæ Simpan</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="menuModal">
    <div class="modal">
        <div class="modal-title">‚úèÔ∏è Edit Menu</div>
        <input type="hidden" id="emId">
        <div class="form-group">
            <label>Nama</label>
            <input type="text" class="form-input" id="emName">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>Harga (RM)</label>
                <input type="number" class="form-input" id="emPrice" step="0.50" min="0">
            </div>
            <div class="form-group">
                <label>Kategori</label>
                <select class="form-input" id="emCat">
                    <option value="Makanan">üçö Makanan</option>
                    <option value="Minuman">ü•§ Minuman</option>
                    <option value="Kuih">üç∞ Kuih</option>
                    <option value="Tambahan">‚ûï Tambahan</option>
                    <option value="Set">üç± Set</option>
                    <option value="Lain-lain">üì¶ Lain-lain</option>
                </select>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn btn-outline" onclick="closeM('menuModal')">Batal</button>
            <button class="btn btn-success" onclick="saveMenu()">üíæ Simpan</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="receiptModal">
    <div class="modal">
        <div id="receiptBox"></div>
        <div class="modal-actions">
            <button class="btn btn-outline" onclick="closeM('receiptModal')">Tutup</button>
            <button class="btn btn-info" onclick="window.print()">üñ®Ô∏è Cetak</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="completeModal">
    <div class="modal">
        <div class="modal-title">üí∞ Selesaikan Pesanan <span id="completeOrderNum"></span></div>
        <div id="completeItems"></div>
        <div class="total-bar">
            <span class="total-label">JUMLAH</span>
            <span class="total-amount">RM <span id="completeTotal">0.00</span></span>
        </div>
        <div style="font-weight:800;font-size:0.9rem;margin:12px 0 8px">üí∞ Cara Bayar</div>
        <div class="payment-methods">
            <button class="pay-btn active" id="cPayCash" onclick="pickCompletePay('cash')"><span class="pay-icon">üíµ</span>Tunai</button>
            <button class="pay-btn" id="cPayQr" onclick="pickCompletePay('qr')"><span class="pay-icon">üì±</span>QR</button>
            <button class="pay-btn" id="cPayTransfer" onclick="pickCompletePay('transfer')"><span class="pay-icon">üè¶</span>Transfer</button>
        </div>
        <div class="cash-calc show" id="completeCashCalc">
            <div class="cash-row">
                <label>üíµ Diterima:</label>
                <input type="number" class="cash-input" id="completeCashIn" oninput="calcCompleteChange()" placeholder="0.00" step="0.50">
            </div>
            <div class="change-box" id="completeChangeBox">-</div>
        </div>
        <div class="pay-info-box" id="completeQrBox"></div>
        <div class="pay-info-box" id="completeTransferBox"></div>
        <div class="modal-actions">
            <button class="btn btn-outline" onclick="closeM('completeModal')">Batal</button>
            <button class="btn btn-success" onclick="doCompleteOrder()" id="btnComplete">‚úÖ Selesai & Bayar</button>
        </div>
    </div>
</div>

<script>
const C={URL:'https://script.google.com/macros/s/AKfycbxuZ9XDiYNtWWz4lyYMd9D_iz500AJXM5w_e0pS9LQ8Xr2E45aGbk4Fd6nOL4ZYTLoq/exec',KEY:'aca6f58aac70a3c722e74b9e0488bd693637e056de95a296f6b40613104b1df7',PAKEJ:'premium'};
let S={menu:[],cart:[],orders:[],staff:{name:'Admin',role:'admin'},pay:'cash',cat:'Semua',editOid:null,editItems:[],shop:{shopName:'Kedai Makan',shopAddress:'',shopPhone:''},count:0,reportMode:'daily',orderFilter:'all',qrImage:'',bankName:'',bankAccount:'',bankHolder:'',completePay:'cash',completeOid:null,qrBase64:''};
let salesCache={daily:null,weekly:null,monthly:null};
const clientCache={};
const CLIENT_CACHE_TTL=30000;

function esc(str){if(!str)return'';const d=document.createElement('div');d.textContent=String(str);return d.innerHTML}
function debounce(fn,ms=300){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}

async function api(action,data={}){const st=Date.now();try{const c=new AbortController();const to=setTimeout(()=>c.abort(),20000);const r=await fetch(C.URL,{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({apiKey:C.KEY,action,data}),redirect:'follow',signal:c.signal});clearTimeout(to);const t=await r.text();console.log('[API]',action,(Date.now()-st)+'ms');try{return JSON.parse(t)}catch{return{success:false,error:'Response bukan JSON'}}}catch(e){if(e.name==='AbortError')return{success:false,error:'Timeout (20s)'};return{success:false,error:e.message}}}

async function cachedApi(action,data={},ttl=CLIENT_CACHE_TTL){const key=action+JSON.stringify(data);const now=Date.now();if(clientCache[key]&&(now-clientCache[key].time)<ttl){console.log('[CACHE]',action);return clientCache[key].data}const r=await api(action,data);if(r.success)clientCache[key]={data:r,time:now};return r}
function clearClientCache(prefix){Object.keys(clientCache).forEach(k=>{if(!prefix||k.startsWith(prefix))delete clientCache[k]})}

function toast(msg,type='success'){const w=document.getElementById('toastWrap');const t=document.createElement('div');t.className='toast '+type;t.textContent=msg;w.appendChild(t);setTimeout(()=>t.remove(),3000)}
function beep(ok){try{const ctx=new(window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator();const g=ctx.createGain();o.connect(g);g.connect(ctx.destination);g.gain.value=0.08;if(ok){o.frequency.value=800;o.start();setTimeout(()=>o.frequency.value=1200,100);setTimeout(()=>{o.stop();ctx.close()},250)}else{o.frequency.value=400;o.start();setTimeout(()=>o.frequency.value=250,120);setTimeout(()=>{o.stop();ctx.close()},250)}}catch(e){}}

async function doLogin(){const pin=document.getElementById('pinInput').value;if(!pin){toast('Masukkan PIN!','error');return}document.querySelector('.btn-login').textContent='‚è≥ Menyemak...';document.querySelector('.btn-login').disabled=true;const r=await api('login',{pin});document.querySelector('.btn-login').textContent='üîì Masuk';document.querySelector('.btn-login').disabled=false;if(r.success){S.staff=r.staff;enterApp()}else{beep(false);toast('‚ùå '+r.error,'error')}}
function skipLogin(){S.staff={name:'Admin',role:'admin'};enterApp()}
async function enterApp(){document.getElementById('loginScreen').style.display='none';document.getElementById('appContainer').classList.add('show');document.getElementById('staffBadge').textContent='üë§ '+esc(S.staff.name);await Promise.all([loadMenu(),loadCount(),loadPaymentInfo()]);applyPakejLimits();if(S.staff.role!=='admin')document.getElementById('tabSettings').style.display='none'}
function doLogout(){if(S.cart.length>0&&!confirm('Ada item dalam troli. Keluar?'))return;document.getElementById('loginScreen').style.display='flex';document.getElementById('appContainer').classList.remove('show');document.getElementById('pinInput').value='';S.cart=[]}
function go(tab,el){document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));el.classList.add('active');document.getElementById('tab-'+tab).classList.add('active');if(tab==='list')loadOrders();if(tab==='sales'){initSalesTab();if(S.reportMode==='daily')loadDailySales();else if(S.reportMode==='weekly')loadWeeklySales();else loadMonthlySales()}if(tab==='menu')loadMenuManage();if(tab==='settings'){loadStaffList();loadSettingsForm()}}

async function loadMenu(){const r=await cachedApi('getMenu',{},60000);if(r.success){S.menu=r.menu;renderCats();renderMenu()}else document.getElementById('menuGrid').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>'+esc(r.error)+'</div>'}
function renderCats(){const cats=['Semua',...new Set(S.menu.map(m=>m.category))];const ic={Semua:'üçΩÔ∏è',Makanan:'üçö',Minuman:'ü•§',Kuih:'üç∞',Tambahan:'‚ûï',Set:'üç±','Lain-lain':'üì¶'};document.getElementById('catFilter').innerHTML=cats.map(c=>'<button class="cat-chip '+(c===S.cat?'active':'')+'" onclick="pickCat(\''+esc(c)+'\',this)">'+(ic[c]||'üì¶')+' '+esc(c)+'</button>').join('')}
function pickCat(c,el){S.cat=c;document.querySelectorAll('.cat-chip').forEach(x=>x.classList.remove('active'));el.classList.add('active');renderMenu()}
function renderMenu(){const g=document.getElementById('menuGrid');const q=document.getElementById('menuSearch').value.toLowerCase();let l=S.menu;if(S.cat!=='Semua')l=l.filter(m=>m.category===S.cat);if(q)l=l.filter(m=>m.name.toLowerCase().includes(q));if(!l.length){g.innerHTML='<div class="empty"><div class="empty-icon">üçΩÔ∏è</div>Tiada menu</div>';return}g.innerHTML=l.map(m=>{const c=S.cart.find(x=>x.id===m.id);return'<div class="menu-item '+(c?'selected':'')+'" onclick="addCart(\''+esc(m.id)+'\')" data-id="'+esc(m.id)+'">'+(c?'<div class="item-badge">'+c.qty+'</div>':'')+'<div class="item-cat">'+esc(m.category)+'</div><div class="item-name">'+esc(m.name)+'</div><div class="item-price">RM'+m.price.toFixed(2)+'</div></div>'}).join('')}
document.getElementById('menuSearch').addEventListener('input',debounce(renderMenu,250));

function addCart(id){const m=S.menu.find(x=>x.id===id);if(!m)return;const c=S.cart.find(x=>x.id===id);if(c)c.qty++;else S.cart.push({id:m.id,name:m.name,price:m.price,qty:1});beep(true);renderCart();renderMenu();const el=document.querySelector('.menu-item[data-id="'+id+'"]');if(el){el.classList.remove('just-added');void el.offsetWidth;el.classList.add('just-added')}}
function cartQty(id,d){const c=S.cart.find(x=>x.id===id);if(!c)return;c.qty+=d;if(c.qty<=0)S.cart=S.cart.filter(x=>x.id!==id);renderCart();renderMenu()}
function clearCart(){if(!S.cart.length)return;if(!confirm('Kosongkan troli?'))return;S.cart=[];document.getElementById('discountAmt').value=0;renderCart();renderMenu()}
function renderCart(){const ce=document.getElementById('cartEmpty'),cc=document.getElementById('cartContent'),cn=document.getElementById('cartCount');const ti=S.cart.reduce((s,i)=>s+i.qty,0);cn.textContent=ti;if(!S.cart.length){ce.style.display='block';cc.style.display='none';return}ce.style.display='none';cc.style.display='flex';let sub=0;document.getElementById('cartList').innerHTML=S.cart.map(i=>{const st=i.price*i.qty;sub+=st;return'<div class="cart-item"><div class="cart-info"><div class="cart-name">'+esc(i.name)+'</div><div class="cart-price">RM'+i.price.toFixed(2)+' √ó '+i.qty+'</div></div><div class="cart-controls"><button class="qty-btn minus" onclick="cartQty(\''+esc(i.id)+'\',-1)">‚àí</button><span class="cart-qty">'+i.qty+'</span><button class="qty-btn" onclick="cartQty(\''+esc(i.id)+'\',1)">+</button></div><div class="cart-subtotal">RM'+st.toFixed(2)+'</div></div>'}).join('');const disc=parseFloat(document.getElementById('discountAmt').value)||0;const total=Math.max(0,sub-disc);document.getElementById('summaryLines').innerHTML='<div class="subtotal-line"><span>Subtotal</span><span>RM '+sub.toFixed(2)+'</span></div>'+(disc>0?'<div class="subtotal-line discount-line"><span>üè∑Ô∏è Diskaun</span><span>- RM '+disc.toFixed(2)+'</span></div>':'');document.getElementById('cartTotal').textContent=total.toFixed(2);renderQuickCash(total);calcChange()}
function renderQuickCash(t){if(!t||t<=0){document.getElementById('quickCash').innerHTML='';return}const s=[t];const c=Math.ceil(t);if(c!==t)s.push(c);[5,10,20,50,100].forEach(n=>{if(n>=t&&!s.includes(n))s.push(n)});document.getElementById('quickCash').innerHTML=[...new Set(s)].slice(0,5).map(v=>'<button class="quick-cash-btn" onclick="setCash('+v+')">RM'+v.toFixed(2)+'</button>').join('')}
function setCash(v){document.getElementById('cashIn').value=v.toFixed(2);calcChange()}
function pickPay(m,el){S.pay=m;document.querySelectorAll('#cartContent .pay-btn').forEach(b=>b.classList.remove('active'));el.classList.add('active');document.getElementById('cashCalc').classList.toggle('show',m==='cash');document.getElementById('qrBox').classList.toggle('show',m==='qr');document.getElementById('transferBox').classList.toggle('show',m==='transfer')}
function calcChange(){const t=parseFloat(document.getElementById('cartTotal').textContent)||0;const g=parseFloat(document.getElementById('cashIn').value)||0;const b=document.getElementById('changeBox');if(!g){b.textContent='-';b.className='change-box';return}const c=g-t;if(c>=0){b.textContent='Baki: RM '+c.toFixed(2);b.className='change-box ok'}else{b.textContent='Kurang: RM '+Math.abs(c).toFixed(2);b.className='change-box bad'}}

async function loadPaymentInfo(){const r=await cachedApi('getSettings',{},120000);if(r.success){S.qrImage=r.qrImage||'';S.bankName=r.bankName||'';S.bankAccount=r.bankAccount||'';S.bankHolder=r.bankHolder||'';renderPaymentInfo()}}
function renderPaymentInfo(){const qC=document.getElementById('qrContent'),cq=document.getElementById('completeQrBox');if(S.qrImage){const img='<img src="'+S.qrImage+'" alt="QR" style="max-width:220px;border-radius:12px;border:2px solid var(--border)">';qC.innerHTML=img;cq.innerHTML='<p style="font-weight:700;margin-bottom:10px">üì± Scan QR</p>'+img}else{qC.innerHTML='<p style="color:var(--gray)">QR belum disetup.</p>';cq.innerHTML='<p style="color:var(--gray)">QR belum disetup.</p>'}const tC=document.getElementById('transferContent'),ct=document.getElementById('completeTransferBox');if(S.bankAccount){const h='<div class="bank-detail"><strong>'+esc(S.bankName||'Bank')+'</strong><div class="bank-acc">'+esc(S.bankAccount)+'</div><div>a/n: <strong>'+esc(S.bankHolder||'-')+'</strong></div></div>';tC.innerHTML=h;ct.innerHTML='<p style="font-weight:700;margin-bottom:10px">üè¶ Transfer</p>'+h}else{tC.innerHTML='<p style="color:var(--gray)">Bank belum disetup.</p>';ct.innerHTML='<p style="color:var(--gray)">Bank belum disetup.</p>'}}

async function submitOrder(){if(!S.cart.length){toast('Pilih menu!','error');return}const btn=document.getElementById('btnSubmit');btn.disabled=true;btn.textContent='‚è≥ Menghantar...';const disc=parseFloat(document.getElementById('discountAmt').value)||0;const tn=document.getElementById('tableNo').value||'-';const r=await api('createOrder',{items:S.cart.map(i=>({name:i.name,price:i.price,qty:i.qty})),tableNo:tn,paymentMethod:S.pay,staffName:S.staff.name,discount:disc});btn.disabled=false;btn.innerHTML='‚úÖ Selesai & Bayar';if(r.success){beep(true);toast('‚úÖ '+r.message);S.count=r.orderNo;document.getElementById('orderCounter').textContent='#'+r.orderNo;showReceipt(r,S.cart,disc);resetOrder();clearClientCache()}else{beep(false);toast('‚ùå '+r.error,'error')}}
async function saveOrderPending(){if(!S.cart.length){toast('Pilih menu!','error');return}const btn=document.getElementById('btnSave');btn.disabled=true;btn.textContent='‚è≥ Menyimpan...';const disc=parseFloat(document.getElementById('discountAmt').value)||0;const tn=document.getElementById('tableNo').value||'-';const r=await api('saveOrder',{items:S.cart.map(i=>({name:i.name,price:i.price,qty:i.qty})),tableNo:tn,staffName:S.staff.name,discount:disc});btn.disabled=false;btn.innerHTML='üíæ Simpan';if(r.success){beep(true);toast('‚úÖ '+r.message);S.count=r.orderNo;document.getElementById('orderCounter').textContent='#'+r.orderNo;resetOrder();clearClientCache()}else{beep(false);toast('‚ùå '+r.error,'error')}}
function resetOrder(){S.cart=[];document.getElementById('tableNo').value='';document.getElementById('cashIn').value='';document.getElementById('discountAmt').value='0';document.getElementById('changeBox').textContent='-';document.getElementById('changeBox').className='change-box';renderCart();renderMenu()}

function showReceipt(order,items,disc){const total=parseFloat(order.total);const cashIn=parseFloat(document.getElementById('cashIn').value)||total;const change=cashIn-total;const table=document.getElementById('tableNo').value||'-';const pL={cash:'Tunai',qr:'QR Pay',transfer:'Pindahan'};const now=new Date();let sub=0;const ih=items.map(i=>{const st=i.price*i.qty;sub+=st;return'<div class="receipt-line"><span>'+esc(i.name)+' x'+i.qty+'</span><span>'+st.toFixed(2)+'</span></div>'}).join('');document.getElementById('receiptBox').innerHTML='<div class="receipt" id="receiptPrint"><div class="receipt-header"><div class="receipt-shop">'+esc(S.shop.shopName)+'</div>'+(S.shop.shopAddress?'<div class="receipt-addr">'+esc(S.shop.shopAddress)+'</div>':'')+(S.shop.shopPhone?'<div class="receipt-addr">'+esc(S.shop.shopPhone)+'</div>':'')+'<div style="margin-top:6px">Pesanan #'+order.orderNo+'</div><div>'+now.toLocaleDateString('ms-MY')+' '+now.toLocaleTimeString('ms-MY')+'</div><div>Meja: '+esc(table)+' | Staff: '+esc(S.staff.name)+'</div></div>'+ih+'<div class="receipt-divider"></div><div class="receipt-line"><span>Subtotal</span><span>'+sub.toFixed(2)+'</span></div>'+(disc>0?'<div class="receipt-line" style="color:var(--success)"><span>Diskaun</span><span>-'+disc.toFixed(2)+'</span></div>':'')+'<div class="receipt-divider"></div><div class="receipt-total"><div class="receipt-line"><span>JUMLAH</span><span>RM '+total.toFixed(2)+'</span></div></div><div class="receipt-divider"></div><div class="receipt-line"><span>Bayar ('+pL[S.pay]+')</span><span>RM '+cashIn.toFixed(2)+'</span></div>'+(S.pay==='cash'?'<div class="receipt-line"><span>Baki</span><span>RM '+change.toFixed(2)+'</span></div>':'')+'<div class="receipt-footer">Terima Kasih! üôè<br>Sila datang lagi</div></div>';document.getElementById('receiptModal').classList.add('show')}
function viewReceipt(o){const pL={cash:'Tunai',qr:'QR Pay',transfer:'Pindahan'};let sub=0;const ih=o.items.map(i=>{const st=i.price*i.qty;sub+=st;return'<div class="receipt-line"><span>'+esc(i.name)+' x'+i.qty+'</span><span>'+st.toFixed(2)+'</span></div>'}).join('');document.getElementById('receiptBox').innerHTML='<div class="receipt" id="receiptPrint"><div class="receipt-header"><div class="receipt-shop">'+esc(S.shop.shopName)+'</div>'+(S.shop.shopAddress?'<div class="receipt-addr">'+esc(S.shop.shopAddress)+'</div>':'')+'<div style="margin-top:6px">Pesanan #'+(o.orderNo||'?')+'</div><div>'+esc(o.date)+' '+esc(o.time)+'</div><div>Meja: '+esc(o.tableNo)+' | Staff: '+esc(o.staffName||'-')+'</div></div>'+ih+'<div class="receipt-divider"></div>'+(o.discount>0?'<div class="receipt-line"><span>Subtotal</span><span>'+sub.toFixed(2)+'</span></div><div class="receipt-line" style="color:var(--success)"><span>Diskaun</span><span>-'+o.discount.toFixed(2)+'</span></div><div class="receipt-divider"></div>':'')+'<div class="receipt-total"><div class="receipt-line"><span>JUMLAH</span><span>RM '+o.total.toFixed(2)+'</span></div></div><div class="receipt-line"><span>Bayar: '+(pL[o.paymentMethod]||'Tunai')+'</span><span></span></div><div class="receipt-footer">Terima Kasih! üôè</div></div>';document.getElementById('receiptModal').classList.add('show')}

async function loadOrders(){const d=document.getElementById('orderDate');if(!d.value)d.value=today();document.getElementById('ordersList').innerHTML='<div class="loading"><div class="spinner"></div>Memuatkan...</div>';const r=await api('getOrders',{date:d.value});if(r.success){S.orders=r.orders;renderOrders()}else document.getElementById('ordersList').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>'+esc(r.error)+'</div>'}
function filterOrders(f,el){S.orderFilter=f;document.querySelectorAll('.order-filter-btn').forEach(b=>b.classList.remove('active'));el.classList.add('active');renderOrders()}
function renderOrders(){const c=document.getElementById('ordersList');let l=S.orders;if(S.orderFilter!=='all')l=l.filter(o=>o.status===S.orderFilter);if(!l.length){c.innerHTML='<div class="empty"><div class="empty-icon">üìã</div>Tiada pesanan</div>';return}const pi={cash:'üíµ',qr:'üì±',transfer:'üè¶'};c.innerHTML=l.map(o=>{const idx=S.orders.indexOf(o);const itxt=o.items.map(i=>esc(i.name)+' √ó'+i.qty).join(', ');const dn=o.status==='completed',pn=o.status==='pending';const bc=dn?'badge-done':pn?'badge-pending':'badge-cancel';const bt=dn?'‚úÖ Selesai':pn?'‚è≥ Belum Bayar':'‚ùå Dibatal';const cc=dn?'':pn?'pending':'cancelled';return'<div class="order-card '+cc+'"><div class="order-header"><div><div class="order-num">#'+(o.orderNo||'?')+'</div><div class="order-id">'+esc(o.orderId)+'</div><div class="order-time">‚è∞ '+esc(o.time)+(o.tableNo!=='-'?' ¬∑ ü™ë '+esc(o.tableNo):'')+'</div><div class="order-staff">üë§ '+esc(o.staffName||'-')+'</div></div><span class="order-badge '+bc+'">'+bt+'</span></div><div class="order-items">'+itxt+'</div><div class="order-bottom"><div><div class="order-total">RM '+o.total.toFixed(2)+'</div>'+(o.discount>0?'<div class="order-discount">üè∑Ô∏è -RM'+o.discount.toFixed(2)+'</div>':'')+(dn?'<div class="order-pay">'+(pi[o.paymentMethod]||'üíµ')+' '+esc(o.paymentMethod)+'</div>':'')+'</div><div class="order-actions">'+(pn?'<button class="btn btn-success btn-sm" onclick="openComplete(S.orders['+idx+'])">üí∞</button><button class="btn btn-danger btn-sm" onclick="cancelOrd(\''+esc(o.orderId)+'\')">üóëÔ∏è</button>':'')+(dn?'<button class="btn btn-warning btn-sm" onclick="openEdit(S.orders['+idx+'])">‚úèÔ∏è</button><button class="btn btn-danger btn-sm" onclick="cancelOrd(\''+esc(o.orderId)+'\')">üóëÔ∏è</button><button class="btn btn-info btn-sm" onclick="viewReceipt(S.orders['+idx+'])">üßæ</button>':'')+'</div></div></div>'}).join('')}
async function cancelOrd(id){if(!confirm('Batalkan pesanan ini?'))return;const r=await api('cancelOrder',{orderId:id});if(r.success){beep(true);toast('‚úÖ '+r.message);clearClientCache();loadOrders()}else toast('‚ùå '+r.error,'error')}

function openComplete(o){S.completeOid=o.orderId;S.completePay='cash';document.getElementById('completeOrderNum').textContent='#'+(o.orderNo||'?');document.getElementById('completeTotal').textContent=o.total.toFixed(2);document.getElementById('completeItems').innerHTML=o.items.map(i=>'<div class="receipt-line" style="padding:6px 0"><span>'+esc(i.name)+' √ó'+i.qty+'</span><span>RM'+(i.price*i.qty).toFixed(2)+'</span></div>').join('');document.querySelectorAll('#completeModal .pay-btn').forEach(b=>b.classList.remove('active'));document.getElementById('cPayCash').classList.add('active');document.getElementById('completeCashCalc').classList.add('show');document.getElementById('completeQrBox').classList.remove('show');document.getElementById('completeTransferBox').classList.remove('show');document.getElementById('completeCashIn').value='';document.getElementById('completeChangeBox').textContent='-';document.getElementById('completeChangeBox').className='change-box';document.getElementById('completeModal').classList.add('show')}
function pickCompletePay(m){S.completePay=m;document.querySelectorAll('#completeModal .pay-btn').forEach(b=>b.classList.remove('active'));document.getElementById('cPay'+m.charAt(0).toUpperCase()+m.slice(1)).classList.add('active');document.getElementById('completeCashCalc').classList.toggle('show',m==='cash');document.getElementById('completeQrBox').classList.toggle('show',m==='qr');document.getElementById('completeTransferBox').classList.toggle('show',m==='transfer')}
function calcCompleteChange(){const t=parseFloat(document.getElementById('completeTotal').textContent)||0;const g=parseFloat(document.getElementById('completeCashIn').value)||0;const b=document.getElementById('completeChangeBox');if(!g){b.textContent='-';b.className='change-box';return}const c=g-t;if(c>=0){b.textContent='Baki: RM '+c.toFixed(2);b.className='change-box ok'}else{b.textContent='Kurang: RM '+Math.abs(c).toFixed(2);b.className='change-box bad'}}
async function doCompleteOrder(){const btn=document.getElementById('btnComplete');btn.disabled=true;btn.textContent='‚è≥...';const r=await api('completeOrder',{orderId:S.completeOid,paymentMethod:S.completePay});btn.disabled=false;btn.textContent='‚úÖ Selesai & Bayar';if(r.success){beep(true);toast('‚úÖ '+r.message);closeM('completeModal');viewReceipt(r.order);clearClientCache();loadOrders()}else{beep(false);toast('‚ùå '+r.error,'error')}}

function openEdit(o){S.editOid=o.orderId;S.editItems=JSON.parse(JSON.stringify(o.items));document.getElementById('editId').textContent='#'+(o.orderNo||o.orderId);document.getElementById('editModal').classList.add('show');renderEditItems()}
function renderEditItems(){let t=0;document.getElementById('editItems').innerHTML=S.editItems.map((i,x)=>{const st=i.price*i.qty;t+=st;return'<div class="cart-item"><div class="cart-info"><div class="cart-name">'+esc(i.name)+'</div><div class="cart-price">RM'+i.price.toFixed(2)+'</div></div><div class="cart-controls"><button class="qty-btn minus" onclick="eQty('+x+',-1)">‚àí</button><span class="cart-qty">'+i.qty+'</span><button class="qty-btn" onclick="eQty('+x+',1)">+</button></div><div class="cart-subtotal">RM'+st.toFixed(2)+'</div></div>'}).join('');document.getElementById('editTotal').textContent=t.toFixed(2)}
function eQty(i,d){S.editItems[i].qty+=d;if(S.editItems[i].qty<=0)S.editItems.splice(i,1);renderEditItems()}
async function saveEdit(){if(!S.editItems.length){toast('Mesti ada 1 item!','error');return}const r=await api('updateOrder',{orderId:S.editOid,items:S.editItems});if(r.success){toast('‚úÖ '+r.message);closeM('editModal');clearClientCache();loadOrders()}else toast('‚ùå '+r.error,'error')}

function initSalesTab(){const dp=document.getElementById('reportDatePicker');if(dp&&!dp.innerHTML.trim())dp.innerHTML='<div class="date-nav"><button class="date-nav-btn" onclick="navDate(-1)">‚óÄ</button><input type="date" class="form-input date-nav-input" id="salesDate" onchange="loadDailySales()" value="'+today()+'"><button class="date-nav-btn" onclick="navDate(1)">‚ñ∂</button><button class="date-nav-today" onclick="navToday()">Hari Ini</button></div>'}
function switchReport(mode,el){S.reportMode=mode;document.querySelectorAll('.report-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');const dp=document.getElementById('reportDatePicker');if(mode==='daily'){dp.innerHTML='<div class="date-nav"><button class="date-nav-btn" onclick="navDate(-1)">‚óÄ</button><input type="date" class="form-input date-nav-input" id="salesDate" onchange="loadDailySales()" value="'+today()+'"><button class="date-nav-btn" onclick="navDate(1)">‚ñ∂</button><button class="date-nav-today" onclick="navToday()">Hari Ini</button></div>';loadDailySales()}else if(mode==='weekly'){dp.innerHTML='<div class="today-badge">üìÖ 7 hari terakhir</div>';loadWeeklySales()}else{dp.innerHTML='<div class="date-nav"><button class="date-nav-btn" onclick="navMonth(-1)">‚óÄ</button><input type="month" class="form-input date-nav-input" id="salesMonth" onchange="loadMonthlySales()" value="'+today().substring(0,7)+'"><button class="date-nav-btn" onclick="navMonth(1)">‚ñ∂</button></div>';loadMonthlySales()}}
function navDate(d){const el=document.getElementById('salesDate');if(!el)return;const dt=new Date(el.value);dt.setDate(dt.getDate()+d);el.value=dt.toISOString().split('T')[0];loadDailySales()}
function navToday(){const el=document.getElementById('salesDate');if(el){el.value=today();loadDailySales()}}
function navMonth(d){const el=document.getElementById('salesMonth');if(!el)return;const p=el.value.split('-');const dt=new Date(parseInt(p[0]),parseInt(p[1])-1+d,1);el.value=dt.getFullYear()+'-'+String(dt.getMonth()+1).padStart(2,'0');loadMonthlySales()}
function formatDateShort(d){const dt=new Date(d+'T00:00:00');const m=['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogos','Sep','Okt','Nov','Dis'];return dt.getDate()+' '+m[dt.getMonth()]}
function formatDateMY(d){const dt=new Date(d+'T00:00:00');const dy=['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'];const m=['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogos','Sep','Okt','Nov','Dis'];return dy[dt.getDay()]+', '+dt.getDate()+' '+m[dt.getMonth()]+' '+dt.getFullYear()}
function trendBadge(c,p,l){if(p===undefined||p===null)return'';if(p===0&&c===0)return'<div class="stat-trend neutral">‚Äî Sama</div>';if(p===0)return'<div class="stat-trend up">‚Üë Baru</div>';const pc=((c-p)/p*100).toFixed(0);if(c>p)return'<div class="stat-trend up">‚Üë '+pc+'% '+(l||'')+'</div>';if(c<p)return'<div class="stat-trend down">‚Üì '+Math.abs(pc)+'% '+(l||'')+'</div>';return'<div class="stat-trend neutral">‚Äî Sama</div>'}

function makeDonutChart(items,max,cl){const co=['#f97316','#3b82f6','#10b981','#f59e0b','#8b5cf6','#ec4899','#06b6d4','#84cc16'];const top=items.slice(0,max||6);const total=top.reduce((s,i)=>s+i.qty,0);if(!total)return'<div class="empty">Tiada data</div>';let a=0;const sg=[];top.forEach((it,idx)=>{const pc=(it.qty/total)*100;const end=a+pc*3.6;sg.push({color:co[idx%co.length],start:a,end:end,name:it.name,qty:it.qty,pct:pc.toFixed(0)});a=end});let gr='conic-gradient(';sg.forEach((s,i)=>{gr+=s.color+' '+s.start.toFixed(1)+'deg '+s.end.toFixed(1)+'deg';if(i<sg.length-1)gr+=','});gr+=')';const lg=sg.map(s=>'<div class="pie-legend-item"><span class="pie-dot" style="background:'+s.color+'"></span><span class="pie-legend-name">'+esc(s.name)+'</span><span class="pie-legend-val">'+s.qty+'</span><span class="pie-legend-pct">('+s.pct+'%)</span></div>').join('');return'<div class="donut-container"><div class="donut-chart" style="background:'+gr+';box-shadow:0 4px 20px rgba(0,0,0,0.08)"><div class="donut-hole"><div class="donut-hole-val">'+total+'</div><div class="donut-hole-label">'+(cl||'unit')+'</div></div></div><div class="pie-legend">'+lg+'</div></div>'}
function makeHourlyChart(hd){if(!hd||!Object.keys(hd).length)return'';const hrs=[];for(let h=7;h<=23;h++){const k=String(h).padStart(2,'0');hrs.push({h:h,l:k+':00',s:hd[k]||0})}const mx=Math.max(...hrs.map(h=>h.s),1);const pk=hrs.reduce((a,b)=>a.s>b.s?a:b);return'<div class="hourly-chart">'+hrs.map(h=>{const ht=Math.max(3,(h.s/mx)*100);const lv=h.s===0?'low':h.s>=pk.s*0.7?'peak':'normal';return'<div class="hourly-bar-wrap"><div class="hourly-bar '+lv+'" style="height:'+ht+'%"></div><div class="hourly-label">'+h.l+'</div></div>'}).join('')+'</div>'+(pk.s>0?'<div class="peak-badge">üî• Puncak: '+pk.l+' (RM'+pk.s.toFixed(0)+')</div>':'')}
function makeTopItems(ti,mq){if(!ti||!ti.length)return'<div class="empty">Tiada data</div>';const m=mq||ti[0].qty||1;return ti.map((i,x)=>'<div class="top-item"><div class="top-left"><div class="top-rank '+(x===0?'r1':x===1?'r2':x===2?'r3':'')+'">'+(x+1)+'</div><div class="top-info"><div class="top-name">'+esc(i.name)+'</div><div class="top-rev">RM'+(i.revenue||0).toFixed(2)+'</div></div></div><div class="top-right"><div class="top-qty">'+i.qty+' unit</div><div class="top-bar-bg"><div class="top-bar-fill" style="width:'+((i.qty/m)*100).toFixed(0)+'%"></div></div></div></div>').join('')}
function makePayStats(pb,ts){const t=ts||((pb.cash||0)+(pb.qr||0)+(pb.transfer||0));if(!t)return'';const it=[{i:'üíµ',l:'Tunai',v:pb.cash||0,c:pb.cashCount||0,co:'#10b981'},{i:'üì±',l:'QR',v:pb.qr||0,c:pb.qrCount||0,co:'#3b82f6'},{i:'üè¶',l:'Transfer',v:pb.transfer||0,c:pb.transferCount||0,co:'#8b5cf6'}];return'<div class="pay-stats">'+it.map(p=>'<div class="pay-stat"><div class="ps-icon">'+p.i+'</div><div class="ps-val">RM'+p.v.toFixed(2)+'</div><div class="ps-count">'+p.c+' pesanan</div><div class="ps-label">'+p.l+'</div><div class="ps-bar"><div class="ps-bar-fill" style="width:'+((p.v/t)*100).toFixed(0)+'%;background:'+p.co+'"></div></div></div>').join('')+'</div>'}
function makeCalHeatmap(ms,dd){const p=ms.split('-');const yr=parseInt(p[0]),mo=parseInt(p[1])-1;const fd=new Date(yr,mo,1).getDay();const dm=new Date(yr,mo+1,0).getDate();const td=today();let mx=0;for(let d=1;d<=dm;d++){const k=ms+'-'+String(d).padStart(2,'0');const v=(dd[k]&&dd[k].sales)||0;if(v>mx)mx=v}const dh=['Ahd','Isn','Sel','Rab','Kha','Jum','Sab'];let h='<div class="cal-heatmap">';dh.forEach(d=>{h+='<div class="cal-day-header">'+d+'</div>'});for(let i=0;i<fd;i++)h+='<div class="cal-day empty"></div>';for(let d=1;d<=dm;d++){const k=ms+'-'+String(d).padStart(2,'0');const s=(dd[k]&&dd[k].sales)||0;const o=(dd[k]&&dd[k].orders)||0;const it=k===td;let lv=0;if(mx>0){const pc=s/mx;if(pc>0.8)lv=5;else if(pc>0.6)lv=4;else if(pc>0.4)lv=3;else if(pc>0.2)lv=2;else if(pc>0)lv=1}h+='<div class="cal-day level-'+lv+(it?' today-mark':'')+'" title="'+k+': RM'+s.toFixed(0)+'"><div class="cal-date">'+d+'</div>'+(s>0?'<div class="cal-val">RM'+s.toFixed(0)+'</div>':'')+'</div>'}h+='</div><div class="cal-legend"><span>Kurang</span><div class="cal-legend-box" style="background:var(--bg)"></div><div class="cal-legend-box" style="background:#ffedd5"></div><div class="cal-legend-box" style="background:#fed7aa"></div><div class="cal-legend-box" style="background:#fdba74"></div><div class="cal-legend-box" style="background:#fb923c"></div><div class="cal-legend-box" style="background:var(--primary)"></div><span>Lebih</span></div>';return h}

async function loadDailySales(){const d=document.getElementById('salesDate');if(!d||!d.value)return;document.getElementById('salesDash').innerHTML='<div class="loading"><div class="spinner"></div>Memuatkan...</div>';try{const r=await api('getDailySales',{date:d.value});if(!r.success){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>'+esc(r.error)+'</div>';return}salesCache.daily=r;const pb=r.paymentBreakdown||{},ti=r.topItems||[],hd=r.hourlyData||{},pv=r.previousDay||{};const ts=parseFloat(r.totalSales)||0,pc=r.pendingOrders||0,pa=parseFloat(r.pendingAmount)||0,isT=d.value===today();document.getElementById('salesDash').innerHTML='<div class="today-badge">üìÖ '+formatDateMY(d.value)+(isT?' ¬∑ Hari Ini':'')+'</div><div class="sales-grid"><div class="stat-card hero-stat"><div class="stat-value">RM '+ts.toFixed(2)+'</div><div class="stat-label">Jumlah Jualan</div>'+trendBadge(ts,pv.totalSales,'vs semalam')+'</div><div class="stat-card"><div class="stat-value">'+r.totalOrders+'</div><div class="stat-label">Selesai</div>'+trendBadge(r.totalOrders,pv.totalOrders)+'</div><div class="stat-card"><div class="stat-value" style="color:var(--danger-dark)">'+r.cancelledOrders+'</div><div class="stat-label">Dibatalkan</div></div><div class="stat-card"><div class="stat-value" style="font-size:1.3rem">RM'+(r.averageOrder||'0.00')+'</div><div class="stat-label">Purata</div>'+trendBadge(parseFloat(r.averageOrder||0),pv.averageOrder)+'</div>'+(pc>0?'<div class="stat-card"><div class="stat-value" style="color:var(--warning-dark)">'+pc+'</div><div class="stat-label">‚è≥ Belum Bayar</div><div class="stat-trend neutral">RM'+pa.toFixed(2)+'</div></div>':'<div class="stat-card"><div class="stat-value" style="color:var(--success-dark);font-size:1.3rem">RM'+parseFloat(r.totalDiscount||0).toFixed(2)+'</div><div class="stat-label">Diskaun</div></div>')+'</div>'+makePayStats(pb,ts)+(Object.keys(hd).length?'<div class="card"><div class="card-title">‚è∞ Mengikut Jam</div>'+makeHourlyChart(hd)+'</div>':'')+'<div class="card"><div class="card-title">ü•ß Menu Terlaris</div>'+makeDonutChart(ti,6,'item')+'</div><div class="card"><div class="card-title">üèÜ Terperinci</div>'+makeTopItems(ti)+'</div>'}catch(e){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>Ralat</div>'}}

async function loadWeeklySales(){document.getElementById('salesDash').innerHTML='<div class="loading"><div class="spinner"></div>Memuatkan...</div>';try{const r=await api('getWeeklySales');if(!r.success){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>'+esc(r.error)+'</div>';return}salesCache.weekly=r;const dy=r.days||[],dd=r.dailyData||{},mx=Math.max(...dy.map(d=>(dd[d]&&dd[d].sales)||0),1),dn=['Ahd','Isn','Sel','Rab','Kha','Jum','Sab'],wt=parseFloat(r.weeklyTotal)||0,ti=r.topItems||[],pw=r.previousWeek||{};let best={date:'',sales:0},worst={date:'',sales:Infinity};dy.forEach(d=>{const s=(dd[d]&&dd[d].sales)||0;if(s>best.sales)best={date:d,sales:s};if(s<worst.sales&&s>0)worst={date:d,sales:s}});if(worst.sales===Infinity)worst={date:'',sales:0};const bars=dy.map(d=>{const s=(dd[d]&&dd[d].sales)||0,o=(dd[d]&&dd[d].orders)||0,h=Math.max(6,(s/mx)*140),nm=dn[new Date(d).getDay()],isT=d===today();return'<div class="chart-bar-wrap'+(isT?' today':'')+'"><div class="chart-bar-value">RM'+s.toFixed(0)+(o?'<br>'+o+' ord':'')+'</div><div class="chart-bar" style="height:'+h+'px;'+((!isT&&s===0)?'background:var(--gray-lighter);opacity:0.4':'')+'"></div><div class="chart-bar-label">'+nm+'<br>'+d.substring(8)+'</div></div>'}).join('');document.getElementById('salesDash').innerHTML='<div class="sales-grid"><div class="stat-card hero-stat"><div class="stat-value">RM '+wt.toFixed(2)+'</div><div class="stat-label">7 Hari</div>'+trendBadge(wt,pw.total,'vs minggu lalu')+'</div><div class="stat-card"><div class="stat-value">'+r.totalOrders+'</div><div class="stat-label">Pesanan</div>'+trendBadge(r.totalOrders,pw.orders)+'</div><div class="stat-card"><div class="stat-value" style="font-size:1.3rem">RM'+(r.totalOrders>0?(wt/r.totalOrders).toFixed(2):'0.00')+'</div><div class="stat-label">Purata</div></div></div><div class="summary-row"><div class="summary-item"><div class="si-val">üìà RM'+best.sales.toFixed(0)+'</div><div class="si-label">Tertinggi ('+formatDateShort(best.date)+')</div></div><div class="summary-divider"></div><div class="summary-item"><div class="si-val">üìâ RM'+worst.sales.toFixed(0)+'</div><div class="si-label">Terendah</div></div><div class="summary-divider"></div><div class="summary-item"><div class="si-val">üìä RM'+(wt/7).toFixed(0)+'</div><div class="si-label">Purata/Hari</div></div></div><div class="card"><div class="card-title">üìà Trend</div><div class="chart-container"><div class="chart-bars">'+bars+'</div></div></div>'+(ti.length?'<div class="card"><div class="card-title">ü•ß Terlaris</div>'+makeDonutChart(ti,6,'item')+'</div><div class="card"><div class="card-title">üèÜ Top Item</div>'+makeTopItems(ti)+'</div>':'')}catch(e){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>Ralat</div>'}}

async function loadMonthlySales(){const m=document.getElementById('salesMonth');if(!m||!m.value)return;document.getElementById('salesDash').innerHTML='<div class="loading"><div class="spinner"></div>Memuatkan...</div>';try{const r=await api('getMonthlySales',{month:m.value});if(!r.success){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>'+esc(r.error)+'</div>';return}salesCache.monthly=r;const ti=r.topItems||[],dd=r.dailyData||{},ts=parseFloat(r.totalSales)||0,pm=r.previousMonth||{},pb=r.paymentBreakdown||{};const mn=['Januari','Februari','Mac','April','Mei','Jun','Julai','Ogos','September','Oktober','November','Disember'];const p=m.value.split('-');const ml=mn[parseInt(p[1])-1]+' '+p[0];document.getElementById('salesDash').innerHTML='<div class="today-badge">üìÜ '+ml+'</div><div class="sales-grid"><div class="stat-card hero-stat"><div class="stat-value">RM '+ts.toFixed(2)+'</div><div class="stat-label">Jualan '+ml+'</div>'+trendBadge(ts,pm.totalSales,'vs bulan lalu')+'</div><div class="stat-card"><div class="stat-value">'+r.totalOrders+'</div><div class="stat-label">Pesanan</div>'+trendBadge(r.totalOrders,pm.totalOrders)+'</div><div class="stat-card"><div class="stat-value" style="font-size:1.3rem">RM'+(r.averageOrder||'0.00')+'</div><div class="stat-label">Purata</div></div><div class="stat-card"><div class="stat-value" style="color:var(--success-dark);font-size:1.3rem">RM'+parseFloat(r.totalDiscount||0).toFixed(2)+'</div><div class="stat-label">Diskaun</div></div></div>'+makePayStats(pb,ts)+'<div class="card"><div class="card-title">üóìÔ∏è Heatmap</div>'+makeCalHeatmap(m.value,dd)+'</div><div class="card"><div class="card-title">ü•ß Terlaris</div>'+makeDonutChart(ti.map(i=>({name:i.name,qty:i.qty,revenue:i.revenue})),8,'item')+'</div><div class="card"><div class="card-title">üèÜ Top 10</div>'+makeTopItems(ti.slice(0,10),ti[0]?ti[0].qty:1)+'</div>'}catch(e){document.getElementById('salesDash').innerHTML='<div class="empty"><div class="empty-icon">‚ùå</div>Ralat</div>'}}

function exportSalesCSV(){let csv='',fn='';if(S.reportMode==='daily'&&salesCache.daily){const r=salesCache.daily,d=document.getElementById('salesDate');fn='jualan_harian_'+(d?d.value:today())+'.csv';csv='Laporan Harian\nTarikh,'+(d?d.value:today())+'\nJumlah,RM '+parseFloat(r.totalSales).toFixed(2)+'\nPesanan,'+r.totalOrders+'\nPurata,RM '+(r.averageOrder||'0.00')+'\n\n';const pb=r.paymentBreakdown||{};csv+='Tunai,RM '+(pb.cash||0).toFixed(2)+'\nQR,RM '+(pb.qr||0).toFixed(2)+'\nTransfer,RM '+(pb.transfer||0).toFixed(2)+'\n\n';if(r.topItems&&r.topItems.length){csv+='Menu,Qty,Hasil\n';r.topItems.forEach(i=>{csv+='"'+i.name+'",'+i.qty+','+(i.revenue||0).toFixed(2)+'\n'})}}else if(S.reportMode==='weekly'&&salesCache.weekly){const r=salesCache.weekly;fn='jualan_mingguan_'+today()+'.csv';csv='Laporan Mingguan\nJumlah,RM '+parseFloat(r.weeklyTotal).toFixed(2)+'\n\nTarikh,Jualan,Pesanan\n';const dd=r.dailyData||{};(r.days||[]).forEach(d=>{csv+=d+','+((dd[d]&&dd[d].sales)||0).toFixed(2)+','+((dd[d]&&dd[d].orders)||0)+'\n'})}else if(S.reportMode==='monthly'&&salesCache.monthly){const r=salesCache.monthly,m=document.getElementById('salesMonth');fn='jualan_bulanan_'+(m?m.value:'')+'.csv';csv='Laporan Bulanan\nJumlah,RM '+parseFloat(r.totalSales).toFixed(2)+'\nPesanan,'+r.totalOrders+'\n\n';if(r.topItems&&r.topItems.length){csv+='Menu,Qty,Hasil\n';r.topItems.forEach(i=>{csv+='"'+i.name+'",'+i.qty+','+(i.revenue||0).toFixed(2)+'\n'})}}else{toast('Tiada data','error');return}const blob=new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=fn;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);toast('‚úÖ CSV dimuat turun!')}

async function loadMenuManage(){const r=await cachedApi('getMenu',{},60000);if(r.success)renderMenuManage(r.menu)}
function renderMenuManage(l){const c=document.getElementById('menuManage');if(!l.length){c.innerHTML='<div class="empty"><div class="empty-icon">üçΩÔ∏è</div>Tiada menu</div>';return}c.innerHTML=l.map(m=>'<div class="menu-manage-item"><div class="mm-info"><div class="mm-name">'+esc(m.name)+'</div><div class="mm-cat">'+esc(m.category)+'</div><div class="mm-price">RM '+m.price.toFixed(2)+'</div></div><div class="mm-actions"><button class="btn btn-warning btn-sm" onclick="openMenuEdit(\''+esc(m.id)+'\',\''+esc(m.name).replace(/'/g,"\\'")+'\','+m.price+',\''+esc(m.category)+'\')">‚úèÔ∏è</button><button class="btn btn-danger btn-sm" onclick="delMenu(\''+esc(m.id)+'\',\''+esc(m.name).replace(/'/g,"\\'")+'\')">üóëÔ∏è</button></div></div>').join('')}
async function addMenu(){const n=document.getElementById('newName').value.trim(),p=document.getElementById('newPrice').value,c=document.getElementById('newCat').value;if(!n||!p){toast('Isi nama & harga!','error');return}const r=await api('addMenu',{name:n,price:parseFloat(p),category:c});if(r.success){toast('‚úÖ '+r.message);document.getElementById('newName').value='';document.getElementById('newPrice').value='';clearClientCache('getMenu');loadMenuManage();loadMenu()}else toast('‚ùå '+r.error,'error')}
function openMenuEdit(id,n,p,c){document.getElementById('emId').value=id;document.getElementById('emName').value=n;document.getElementById('emPrice').value=p;document.getElementById('emCat').value=c;document.getElementById('menuModal').classList.add('show')}
async function saveMenu(){const id=document.getElementById('emId').value,n=document.getElementById('emName').value.trim(),p=document.getElementById('emPrice').value,c=document.getElementById('emCat').value;if(!n||!p){toast('Isi semua!','error');return}const r=await api('updateMenu',{id,name:n,price:parseFloat(p),category:c});if(r.success){toast('‚úÖ '+r.message);closeM('menuModal');clearClientCache('getMenu');loadMenuManage();loadMenu()}else toast('‚ùå '+r.error,'error')}
async function delMenu(id,n){if(!confirm('Padam "'+n+'"?'))return;const r=await api('deleteMenu',{id});if(r.success){toast('‚úÖ '+r.message);clearClientCache('getMenu');loadMenuManage();loadMenu()}else toast('‚ùå '+r.error,'error')}

async function loadStaffList(){const r=await cachedApi('getStaffList',{},60000);if(r.success){const l=r.staffList||[];const c=document.getElementById('staffList');if(!l.length){c.innerHTML='<div class="empty"><div class="empty-icon">üë•</div>Tiada staff</div>';return}c.innerHTML=l.map(s=>'<div class="staff-item"><div class="si-info"><div class="si-name">'+esc(s.name)+'</div><div class="si-role">'+(s.role==='admin'?'üëë Admin':'üë§ Staff')+'</div><div class="si-pin">PIN: '+esc(s.pin)+'</div></div><button class="btn btn-danger btn-sm" onclick="deleteStaff(\''+esc(s.pin)+'\',\''+esc(s.name).replace(/'/g,"\\'")+'\')">üóëÔ∏è</button></div>').join('')}}
async function addStaff(){const p=document.getElementById('newStaffPin').value.trim(),n=document.getElementById('newStaffName').value.trim(),r2=document.getElementById('newStaffRole').value;if(!p||!n){toast('Isi PIN dan Nama!','error');return}const r=await api('addStaff',{pin:p,name:n,role:r2});if(r.success){toast('‚úÖ '+r.message);document.getElementById('newStaffPin').value='';document.getElementById('newStaffName').value='';clearClientCache('getStaff');loadStaffList()}else toast('‚ùå '+r.error,'error')}
async function deleteStaff(p,n){if(!confirm('Padam "'+n+'"?'))return;const r=await api('deleteStaff',{pin:p});if(r.success){toast('‚úÖ '+r.message);clearClientCache('getStaff');loadStaffList()}else toast('‚ùå '+r.error,'error')}
function loadSettingsForm(){document.getElementById('setBankName').value=S.bankName;document.getElementById('setBankAcc').value=S.bankAccount;document.getElementById('setBankHolder').value=S.bankHolder;if(S.qrImage)document.getElementById('qrPreview').innerHTML='<img src="'+S.qrImage+'" style="max-width:200px;border-radius:14px;border:1px solid var(--border)"><p style="font-size:0.75rem;color:var(--gray);margin-top:6px">QR semasa</p>'}
function previewQR(input){if(input.files&&input.files[0]){const r=new FileReader();r.onload=function(e){S.qrBase64=e.target.result;document.getElementById('qrPreview').innerHTML='<img src="'+e.target.result+'" style="max-width:200px;border-radius:14px"><p style="font-size:0.75rem;color:var(--success-dark);margin-top:6px">‚úÖ Preview</p>'};r.readAsDataURL(input.files[0])}}
async function saveQR(){if(!S.qrBase64){toast('Upload QR!','error');return}const r=await api('saveSettings',{qrImage:S.qrBase64});if(r.success){S.qrImage=S.qrBase64;clearClientCache('getSettings');renderPaymentInfo();toast('‚úÖ QR disimpan!')}else toast('‚ùå '+r.error,'error')}
async function saveBankInfo(){const bn=document.getElementById('setBankName').value.trim(),ba=document.getElementById('setBankAcc').value.trim(),bh=document.getElementById('setBankHolder').value.trim();if(!ba){toast('Isi no. akaun!','error');return}const r=await api('saveSettings',{bankName:bn,bankAccount:ba,bankHolder:bh});if(r.success){S.bankName=bn;S.bankAccount=ba;S.bankHolder=bh;clearClientCache('getSettings');renderPaymentInfo();toast('‚úÖ Disimpan!')}else toast('‚ùå '+r.error,'error')}
function applyPakejLimits(){const p=C.PAKEJ;if(p==='asas'){const t=document.querySelector('.table-row');if(t)t.style.display='none';const d=document.querySelector('.discount-section');if(d)d.style.display='none'}if(p==='pro'){const d=document.querySelector('.discount-section');if(d)d.style.display='none'}}

function closeM(id){document.getElementById(id).classList.remove('show')}
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show')})});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.show').forEach(m=>m.classList.remove('show'));if(e.ctrlKey&&e.key==='Enter')submitOrder()});
function today(){return new Date().toISOString().split('T')[0]}
function updateClock(){document.getElementById('clock').textContent=new Date().toLocaleTimeString('ms-MY',{timeZone:'Asia/Kuala_Lumpur',hour:'2-digit',minute:'2-digit'})}
async function loadCount(){const r=await api('getTodayOrderCount');if(r.success){S.count=r.count;document.getElementById('orderCounter').textContent='#'+r.count}}
window.addEventListener('online',()=>{document.getElementById('offDot').style.display='none';document.getElementById('offBanner').classList.remove('show');toast('‚úÖ Online!')});
window.addEventListener('offline',()=>{document.getElementById('offDot').style.display='block';document.getElementById('offBanner').classList.add('show');toast('‚ö†Ô∏è Offline!','error')});
window.addEventListener('beforeunload',e=>{if(S.cart.length){e.preventDefault();e.returnValue=''}});

async function init(){updateClock();setInterval(updateClock,1000);document.getElementById('orderDate').value=today();let info=await api('getShopInfo');if(!info.success){document.getElementById('loginShopName').textContent='‚è≥ Cuba semula...';info=await api('getShopInfo')}if(info.success){S.shop=info;document.getElementById('loginShopName').textContent='üçΩÔ∏è '+info.shopName;document.title='POSKedai - '+info.shopName;if(info.pakej)C.PAKEJ=info.pakej.toLowerCase();if(info.qrImage)S.qrImage=info.qrImage;if(info.bankName)S.bankName=info.bankName;if(info.bankAccount)S.bankAccount=info.bankAccount;if(info.bankHolder)S.bankHolder=info.bankHolder;if(C.PAKEJ==='premium'&&info.brandColor&&info.brandColor!=='#f97316'){document.documentElement.style.setProperty('--primary',info.brandColor);document.documentElement.style.setProperty('--primary-dark',info.brandColor)}}else document.getElementById('loginShopName').innerHTML='‚ö†Ô∏è Gagal<br><span style="font-size:0.75rem;color:var(--danger-dark)">'+esc(info.error||'Error')+'</span>';if(C.PAKEJ==='asas')skipLogin()}
init();
</script>
</body>
</html>

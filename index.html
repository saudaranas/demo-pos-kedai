<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>POSKedai - Sistem POS</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>Plate</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--primary:#f97316;--primary-dark:#ea580c;--primary-light:#fff7ed;--primary-bg:#ffedd5;--success:#34d399;--success-dark:#10b981;--success-light:#ecfdf5;--danger:#f87171;--danger-dark:#ef4444;--danger-light:#fef2f2;--warning:#fbbf24;--warning-dark:#f59e0b;--info:#60a5fa;--info-dark:#3b82f6;--info-light:#eff6ff;--dark:#0f172a;--dark-2:#1e293b;--dark-3:#334155;--gray:#64748b;--gray-light:#94a3b8;--gray-lighter:#cbd5e1;--border:#e2e8f0;--bg:#f1f5f9;--bg-2:#f8fafc;--white:#ffffff;--shadow-xs:0 1px 2px rgba(0,0,0,0.04);--shadow-sm:0 2px 8px rgba(0,0,0,0.04),0 1px 2px rgba(0,0,0,0.06);--shadow:0 4px 24px rgba(0,0,0,0.06);--shadow-lg:0 12px 40px rgba(0,0,0,0.08);--shadow-xl:0 24px 60px rgba(0,0,0,0.12);--shadow-primary:0 8px 30px rgba(249,115,22,0.25);--radius:16px;--radius-lg:20px;--radius-xl:28px;--radius-full:50px;--font:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;--ease:cubic-bezier(0.4,0,0.2,1)}
        html,body{overflow-x:hidden;width:100%;max-width:100vw}
        body{font-family:var(--font);background:var(--bg);color:var(--dark);min-height:100vh;-webkit-tap-highlight-color:transparent;-webkit-font-smoothing:antialiased}
        
        .login-screen{min-height:100vh;background:linear-gradient(145deg,#fff7ed 0%,#fed7aa 30%,#fdba74 60%,#fb923c 100%);display:flex;align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden}
        .login-screen::before{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle,rgba(255,255,255,0.2),transparent 70%);top:-100px;right:-100px;border-radius:50%}
        .login-screen::after{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(249,115,22,0.15),transparent 70%);bottom:-80px;left:-80px;border-radius:50%}
        .login-card{background:rgba(255,255,255,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:var(--radius-xl);padding:48px 36px;width:100%;max-width:400px;box-shadow:var(--shadow-xl),0 0 0 1px rgba(255,255,255,0.5);text-align:center;position:relative;z-index:2}
        .login-logo{font-size:2.2rem;font-weight:900;margin-bottom:4px;letter-spacing:-1px}.login-logo span:first-child{color:var(--primary)}.login-logo span:last-child{color:var(--dark)}
        .login-subtitle{color:var(--gray);font-size:0.88rem;margin-bottom:36px;font-weight:500}
        .login-shop-name{font-size:1.05rem;font-weight:700;color:var(--dark-2);margin-bottom:28px;padding:14px 20px;background:rgba(249,115,22,0.08);border-radius:14px;border:1px solid rgba(249,115,22,0.12)}
        .pin-input{width:100%;padding:18px;border:2px solid var(--border);border-radius:14px;font-size:1.5rem;font-weight:700;text-align:center;letter-spacing:14px;margin-bottom:20px;transition:all 0.3s var(--ease);font-family:var(--font);background:var(--white)}.pin-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.1)}.pin-input::placeholder{letter-spacing:4px;font-size:1rem;color:var(--gray-lighter)}
        .btn-login{width:100%;padding:18px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);border:none;border-radius:14px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s var(--ease);box-shadow:var(--shadow-primary);font-family:var(--font)}.btn-login:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(249,115,22,0.35)}.btn-login:active{transform:scale(0.98)}
        .login-skip{margin-top:20px;color:var(--gray);font-size:0.85rem;cursor:pointer;font-weight:500;transition:color 0.2s}.login-skip:hover{color:var(--primary)}
        
        .app-container{display:none}.app-container.show{display:block}
        .offline-banner{display:none;background:var(--danger);color:white;text-align:center;padding:8px;font-size:0.78rem;font-weight:700}.offline-banner.show{display:block}
        
        .header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);padding:14px 16px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;gap:10px}
        .header-left{display:flex;align-items:center;gap:10px;min-width:0;flex:1}.header-logo{font-weight:900;font-size:1.1rem;letter-spacing:-0.5px;white-space:nowrap}
        .header-staff{background:rgba(255,255,255,0.18);padding:4px 12px;border-radius:var(--radius-full);font-size:0.72rem;font-weight:600;backdrop-filter:blur(8px);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100px}
        .header-right{display:flex;align-items:center;gap:8px;flex-shrink:0}.header-counter{background:rgba(255,255,255,0.18);padding:4px 12px;border-radius:var(--radius-full);font-size:0.75rem;font-weight:700}.header-time{font-size:0.75rem;opacity:0.85;font-weight:500;display:none}
        .btn-logout{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.25);color:white;padding:6px 14px;border-radius:10px;font-size:0.72rem;font-weight:600;cursor:pointer;font-family:var(--font);transition:all 0.2s;white-space:nowrap}.btn-logout:hover{background:rgba(255,255,255,0.22)}
        .offline-dot{display:none;width:8px;height:8px;background:var(--danger);border-radius:50%;animation:pulse 1.5s infinite}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(1.3)}}
        
        .nav-tabs{display:flex;background:var(--white);position:sticky;top:52px;z-index:99;padding:3px;gap:2px;border-bottom:1px solid var(--border);overflow-x:auto;-webkit-overflow-scrolling:touch}
        .nav-tabs::-webkit-scrollbar{display:none}
        .nav-tab{flex:1;padding:8px 4px 6px;text-align:center;cursor:pointer;border:none;background:transparent;font-size:0.65rem;font-weight:600;color:var(--gray-light);border-radius:10px;transition:all 0.3s var(--ease);min-width:52px;white-space:nowrap;font-family:var(--font)}.nav-tab.active{color:var(--primary);background:var(--primary-light)}.nav-tab .tab-icon{font-size:1.1rem;display:block;margin-bottom:1px}
        
        .tab-content{display:none;padding:14px;max-width:1400px;margin:0 auto;padding-bottom:80px;animation:fadeIn 0.4s var(--ease)}.tab-content.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        
        .order-layout{display:flex;gap:20px;align-items:flex-start}
        .order-left{flex:1;min-width:0}
        .order-right{width:380px;flex-shrink:0}
        
        .card{background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius-lg);padding:16px;margin-bottom:12px;box-shadow:var(--shadow-sm);transition:all 0.3s var(--ease)}
        .card-title{font-size:0.9rem;font-weight:800;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:var(--dark);flex-wrap:wrap}
        
        .search-bar{position:relative;margin-bottom:12px}
        .search-bar input{width:100%;padding:12px 16px 12px 40px;border:1px solid var(--border);border-radius:12px;font-size:0.88rem;font-family:var(--font);transition:all 0.3s var(--ease);background:var(--white)}
        .search-bar input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}
        .search-bar::before{content:"Search";position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:0.85rem}
        
        .category-filter{display:flex;gap:6px;overflow-x:auto;padding-bottom:6px;margin-bottom:12px;-webkit-overflow-scrolling:touch}
        .category-filter::-webkit-scrollbar{display:none}
        .cat-chip{padding:8px 16px;border-radius:var(--radius-full);border:1px solid var(--border);background:var(--white);font-size:0.78rem;font-weight:600;cursor:pointer;white-space:nowrap;transition:all 0.25s var(--ease);color:var(--gray);font-family:var(--font)}
        .cat-chip.active{background:var(--primary);color:var(--white);border-color:var(--primary);box-shadow:0 4px 14px rgba(249,115,22,0.25)}
        
        .menu-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
        .menu-item{background:var(--white);border:1.5px solid var(--border);border-radius:14px;padding:14px 8px;text-align:center;cursor:pointer;transition:all 0.25s var(--ease);position:relative;user-select:none;min-width:0}
        .menu-item:active{transform:scale(0.96)}
        .menu-item:hover{border-color:rgba(249,115,22,0.3);box-shadow:var(--shadow)}
        .menu-item.selected{border-color:var(--primary);background:var(--primary-light);box-shadow:0 0 0 3px rgba(249,115,22,0.1)}
        .menu-item .item-cat{font-size:0.58rem;color:var(--gray-light);font-weight:600;margin-bottom:2px;text-transform:uppercase;letter-spacing:0.3px}
        .menu-item .item-name{font-weight:700;font-size:0.78rem;color:var(--dark-2);margin-bottom:4px;line-height:1.2;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;word-break:break-word;min-height:2.4em}
        .menu-item .item-price{color:var(--primary);font-weight:800;font-size:0.92rem}
        .menu-item .item-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:800;box-shadow:0 4px 12px rgba(249,115,22,0.35)}
        .menu-item.just-added{animation:popIn 0.3s var(--ease)}@keyframes popIn{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
        
        .order-right .card{display:flex;flex-direction:column;border:1.5px solid var(--border);box-shadow:var(--shadow);padding:0;overflow:hidden}
        #cartCard .card-title{padding:16px 16px 12px;margin-bottom:0;border-bottom:1px solid var(--bg)}
        #cartContent{display:none;flex-direction:column;flex:1;min-height:0}
        .cart-scroll{padding:0 16px;overflow-y:auto;overflow-x:hidden;flex:1;min-height:0}
        .cart-scroll::-webkit-scrollbar{width:4px}
        .cart-scroll::-webkit-scrollbar-thumb{background:var(--gray-lighter);border-radius:4px}
        .cart-footer{padding:14px 16px 16px;border-top:2px solid var(--bg);background:var(--white);flex-shrink:0}
        
        .table-row{display:flex;gap:8px;align-items:center;margin:12px 0 14px;padding-top:4px}
        .table-row label{font-weight:700;font-size:0.82rem;white-space:nowrap;flex-shrink:0}
        .table-input{flex:1;min-width:0;padding:10px 12px;border:1.5px solid var(--border);border-radius:10px;font-size:0.95rem;font-weight:700;text-align:center;font-family:var(--font);transition:all 0.3s}
        .table-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}
        
        .cart-item{display:flex;align-items:center;gap:8px;padding:10px 0;border-bottom:1px solid var(--bg)}
        .cart-item:last-child{border-bottom:none}
        .cart-info{flex:1;min-width:0;overflow:hidden}
        .cart-name{font-weight:700;font-size:0.85rem;color:var(--dark-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .cart-price{font-size:0.72rem;color:var(--gray);margin-top:2px}
        .cart-controls{display:flex;align-items:center;gap:6px;flex-shrink:0}
        .qty-btn{width:30px;height:30px;border-radius:8px;border:1.5px solid var(--primary);background:var(--white);color:var(--primary);font-size:1rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;font-family:var(--font);transition:all 0.2s;flex-shrink:0}
        .qty-btn:active{transform:scale(0.9);background:var(--primary-light)}
        .qty-btn.minus{border-color:var(--danger);color:var(--danger)}
        .qty-btn.minus:active{background:var(--danger-light)}
        .cart-qty{font-weight:800;font-size:0.88rem;min-width:20px;text-align:center}
        .cart-subtotal{font-weight:800;color:var(--primary);font-size:0.85rem;white-space:nowrap;flex-shrink:0}
        
        .discount-section{display:flex;gap:8px;align-items:center;margin:10px 0;padding:10px 0;border-top:1px dashed var(--border)}
        .discount-section label{font-weight:700;font-size:0.82rem;white-space:nowrap}
        .discount-input{width:90px;padding:8px 10px;border:1.5px solid var(--border);border-radius:10px;font-size:0.88rem;font-weight:700;text-align:center;font-family:var(--font);transition:all 0.3s}
        .discount-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(249,115,22,0.08)}
        
        .subtotal-line{display:flex;justify-content:space-between;font-size:0.82rem;color:var(--gray);padding:3px 0}
        .discount-line{color:var(--success-dark);font-weight:600}
        
        .total-bar{background:var(--dark);color:var(--white);padding:16px 18px;border-radius:14px;display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .total-label{font-size:0.85rem;font-weight:600;opacity:0.8}
        .total-amount{font-size:1.5rem;font-weight:900;letter-spacing:-0.5px}
        
        .payment-methods{display:flex;gap:6px;margin:10px 0}
        .pay-btn{flex:1;padding:12px 6px;border:1.5px solid var(--border);border-radius:12px;background:var(--white);cursor:pointer;text-align:center;font-weight:700;font-size:0.75rem;transition:all 0.25s var(--ease);color:var(--gray);font-family:var(--font)}
        .pay-btn.active{border-color:var(--primary);background:var(--primary-light);color:var(--primary)}
        .pay-btn .pay-icon{font-size:1.2rem;display:block;margin-bottom:2px}
        
        .cash-calc{background:var(--bg-2);border-radius:12px;padding:12px;margin:8px 0;display:none;border:1px solid var(--border)}
        .cash-calc.show{display:block}
        .quick-cash{display:flex;gap:5px;margin-bottom:8px;flex-wrap:wrap}
        .quick-cash-btn{padding:6px 12px;border:1px solid var(--border);border-radius:8px;background:var(--white);font-size:0.72rem;font-weight:700;cursor:pointer;font-family:var(--font);color:var(--dark-2);transition:all 0.2s}
        .quick-cash-btn:hover{border-color:var(--primary);color:var(--primary)}
        .quick-cash-btn:active{transform:scale(0.95);background:var(--primary-light)}
        .cash-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px}
        .cash-row label{font-weight:700;font-size:0.82rem}
        .cash-input{width:120px;padding:10px 12px;border:1.5px solid var(--border);border-radius:10px;font-size:1rem;font-weight:800;text-align:right;font-family:var(--font);background:var(--white)}
        .cash-input:focus{outline:none;border-color:var(--primary)}
        .change-box{text-align:center;padding:12px;border-radius:10px;font-weight:900;font-size:1.1rem}
        .change-box.ok{background:var(--success-light);color:var(--success-dark)}
        .change-box.bad{background:var(--danger-light);color:var(--danger-dark)}
        
        .pay-info-box{background:var(--bg-2);border-radius:12px;padding:16px;margin:8px 0;text-align:center;display:none;border:1px solid var(--border)}
        .pay-info-box.show{display:block}
        .pay-info-box img{max-width:160px;border-radius:10px;margin-bottom:8px;border:1px solid var(--border)}
        .bank-detail{font-size:0.82rem;line-height:1.6}
        .bank-acc{font-size:1.1rem;font-weight:900;color:var(--primary);letter-spacing:1px;margin:5px 0}
        
        .btn-row{display:flex;gap:8px;margin-top:10px}
        .btn-row .btn{flex:1}
        .btn{padding:10px 20px;border:none;border-radius:12px;font-size:0.9rem;font-weight:700;cursor:pointer;transition:all 0.3s var(--ease);display:inline-flex;align-items:center;gap:6px;font-family:var(--font);justify-content:center}
        .btn:active{transform:scale(0.97)}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:var(--white);padding:14px;font-size:0.92rem;box-shadow:var(--shadow-primary)}
        .btn-primary:hover{box-shadow:0 12px 35px rgba(249,115,22,0.35)}
        .btn-success{background:linear-gradient(135deg,var(--success),var(--success-dark));color:var(--white)}
        .btn-danger{background:linear-gradient(135deg,var(--danger),var(--danger-dark));color:var(--white)}
        .btn-warning{background:linear-gradient(135deg,var(--warning),var(--warning-dark));color:var(--white)}
        .btn-info{background:linear-gradient(135deg,var(--info),var(--info-dark));color:var(--white)}
        .btn-outline{background:var(--white);color:var(--dark);border:1.5px solid var(--border)}
        .btn-ghost{background:var(--danger-light);color:var(--danger-dark)}
        .btn-sm{padding:6px 12px;font-size:0.72rem;border-radius:8px}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        .btn-save-order{background:linear-gradient(135deg,var(--info),var(--info-dark));color:var(--white);padding:12px;font-size:0.88rem}
        .shortcut-hint{font-size:0.6rem;color:var(--gray-lighter);text-align:center;margin-top:6px;font-weight:500;display:none}
        
        .cart-empty{text-align:center;padding:40px 20px;color:var(--gray-light)}
        .cart-empty-icon{font-size:2.5rem;margin-bottom:10px;opacity:0.5}
        .cart-empty-text{font-size:0.85rem;font-weight:600}
        .cart-empty-hint{font-size:0.75rem;margin-top:4px;color:var(--gray-lighter)}
        
        .order-card{background:var(--white);border:1px solid rgba(0,0,0,0.04);border-radius:var(--radius-lg);padding:14px;margin-bottom:10px;border-left:4px solid var(--success);box-shadow:var(--shadow-xs);transition:all 0.3s var(--ease)}
        .order-card:hover{box-shadow:var(--shadow)}
        .order-card.pending{border-left-color:var(--warning)}
        .order-card.cancelled{border-left-color:var(--danger);opacity:0.6}
        .order-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;gap:8px;flex-wrap:wrap}
        .order-num{font-weight:900;font-size:1.1rem;color:var(--primary);letter-spacing:-0.5px}
        .order-id{font-size:0.62rem;color:var(--gray-light)}
        .order-time{font-size:0.72rem;color:var(--gray)}
        .order-staff{font-size:0.68rem;color:var(--gray-light)}
        .order-badge{padding:4px 12px;border-radius:var(--radius-full);font-size:0.65rem;font-weight:700;text-transform:uppercase;letter-spacing:0.3px}
        .badge-done{background:var(--success-light);color:var(--success-dark)}
        .badge-pending{background:#fef3c7;color:var(--warning-dark)}
        .badge-cancel{background:var(--danger-light);color:var(--danger-dark)}
        .order-items{font-size:0.78rem;color:var(--gray);margin-bottom:8px;line-height:1.5}
        .order-bottom{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px}
        .order-total{font-weight:900;font-size:1rem;color:var(--primary)}
        .order-discount{font-size:0.68rem;color:var(--success-dark);font-weight:600}
        .order-pay{font-size:0.68rem;color:var(--gray-light)}
        .order-actions{display:flex;gap:5px;flex-wrap:wrap}
        
        .order-filter{display:flex;gap:3px;margin:10px 0;background:var(--bg);padding:3px;border-radius:10px;flex-wrap:wrap}
        .order-filter-btn{flex:1;padding:7px 4px;border:none;border-radius:8px;background:transparent;font-size:0.72rem;font-weight:700;cursor:pointer;color:var(--gray);font-family:var(--font);transition:all 0.2s;min-width:60px}
        .order-filter-btn.active{background:var(--white);color:var(--primary);box-shadow:var(--shadow-xs)}
        
        .toast-wrap{position:fixed;top:60px;right:14px;z-index:1000}
        .toast{background:var(--dark);color:var(--white);padding:12px 18px;border-radius:12px;margin-bottom:6px;animation:slideIn 0.35s var(--ease),fadeOut 0.3s 2.7s forwards;font-size:0.82rem;font-weight:600;box-shadow:var(--shadow-lg);max-width:280px}
        .toast.success{background:var(--success-dark)}
        .toast.error{background:var(--danger-dark)}
        @keyframes slideIn{from{transform:translateX(120%);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes fadeOut{to{opacity:0;transform:translateY(-10px)}}
        
        .empty{text-align:center;padding:30px 16px;color:var(--gray)}
        .empty-icon{font-size:2rem;margin-bottom:8px}
        .loading{text-align:center;padding:24px;color:var(--gray)}
        .spinner{border:3px solid var(--bg);border-top-color:var(--primary);border-radius:50%;width:32px;height:32px;animation:spin 0.8s linear infinite;margin:0 auto 10px}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        @media(min-width:500px){.header-time{display:block}}
        @media(min-width:700px){.shortcut-hint{display:block}}
        @media(min-width:869px){
            .order-layout{display:flex;flex-direction:row;gap:20px;align-items:flex-start}
            .menu-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px}
            .order-right{width:380px;flex-shrink:0;position:sticky;top:110px;max-height:calc(100vh - 130px);overflow-y:auto}
            #cartCard .card-title{padding:16px 16px 12px;margin-bottom:0;border-bottom:1px solid var(--bg);position:sticky;top:0;background:var(--white);z-index:1}
            #cartContent{display:flex;flex-direction:column}
            .cart-scroll{padding:0 16px}
            .cart-footer{padding:14px 16px 16px;border-top:2px solid var(--bg);background:var(--white);position:sticky;bottom:0}
        }
        @media(max-width:868px){.order-layout{flex-direction:column;gap:14px}.order-right{width:100%;position:static;max-height:none}.order-right .card{max-height:none}.cart-scroll{max-height:400px}}
    </style>
</head>
<body>
<div class="login-screen" id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><span>POS</span><span>Kedai</span></div>
        <p class="login-subtitle">Sistem POS Kedai Makanan</p>
        <div class="login-shop-name" id="loginShopName">Memuatkan...</div>
        <input type="password" class="pin-input" id="pinInput" placeholder="PIN" maxlength="6" inputmode="numeric" onkeyup="if(event.key==='Enter')doLogin()">
        <button class="btn-login" onclick="doLogin()">Masuk</button>
        <p class="login-skip" onclick="skipLogin()">Masuk tanpa PIN →</p>
    </div>
</div>

<div class="app-container" id="appContainer">
    <div class="offline-banner" id="offBanner">Tiada internet.</div>
    
    <div class="header">
        <div class="header-left">
            <span class="header-logo"><span>POS</span><span>Kedai</span></span>
            <span class="header-staff" id="staffBadge">Admin</span>
        </div>
        <div class="header-right">
            <span class="offline-dot" id="offDot"></span>
            <span class="header-counter" id="orderCounter">#0</span>
            <span class="header-time" id="clock"></span>
            <button class="btn-logout" onclick="doLogout()">Keluar</button>
        </div>
    </div>
    
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="go('order',this)">Pesanan</button>
        <button class="nav-tab" onclick="go('list',this)">Senarai</button>
        <button class="nav-tab" onclick="go('sales',this)" id="tabSales">Jualan</button>
        <button class="nav-tab" onclick="go('menu',this)" id="tabMenu">Menu</button>
        <button class="nav-tab" onclick="go('settings',this)" id="tabSettings">Tetapan</button>
    </div>
    
    <div class="toast-wrap" id="toastWrap"></div>
    
    <div class="tab-content active" id="tab-order">
        <div class="order-layout">
            <div class="order-left">
                <div class="search-bar"><input type="text" id="menuSearch" placeholder="Cari menu..."></div>
                <div class="category-filter" id="catFilter"></div>
                <div class="menu-grid" id="menuGrid"><div class="loading"><div class="spinner"></div>Memuatkan menu...</div></div>
            </div>
            
            <div class="order-right">
                <div class="card" id="cartCard">
                    <div class="card-title">
                        Troli 
                        <span id="cartCount" style="background:var(--primary);color:white;padding:2px 8px;border-radius:16px;font-size:0.7rem;margin-left:4px">0</span>
                        <span style="margin-left:auto">
                            <button class="btn btn-ghost btn-sm" onclick="clearCart()">Kosong</button>
                        </span>
                    </div>
                    
                    <div id="cartEmpty" class="cart-empty">
                        <div class="cart-empty-icon">Empty</div>
                        <div class="cart-empty-text">Troli kosong</div>
                        <div class="cart-empty-hint">Tekan menu untuk tambah</div>
                    </div>
                    
                    <div id="cartContent">
                        <div class="cart-scroll" id="cartScroll">
                            <div class="table-row">
                                <label>Meja:</label>
                                <input type="text" class="table-input" id="tableNo" placeholder="-" maxlength="10">
                            </div>
                            <div id="cartList"></div>
                            <div class="discount-section">
                                <label>Diskaun (RM):</label>
                                <input type="number" class="discount-input" id="discountAmt" value="0" min="0" step="0.50" oninput="renderCart()">
                            </div>
                            <div id="summaryLines"></div>
                        </div>
                        
                        <div class="cart-footer">
                            <div class="total-bar">
                                <span class="total-label">JUMLAH</span>
                                <span class="total-amount">RM <span id="cartTotal">0.00</span></span>
                            </div>
                            
                            <div style="font-weight:700;font-size:0.82rem;margin-bottom:6px">Cara Bayar</div>
                            <div class="payment-methods">
                                <button class="pay-btn active" onclick="pickPay('cash',this)">Tunai</button>
                                <button class="pay-btn" onclick="pickPay('qr',this)">QR</button>
                                <button class="pay-btn" onclick="pickPay('transfer',this)">Transfer</button>
                            </div>
                            
                            <div class="cash-calc show" id="cashCalc">
                                <div class="quick-cash" id="quickCash"></div>
                                <div class="cash-row">
                                    <label>Diterima:</label>
                                    <input type="number" class="cash-input" id="cashIn" oninput="calcChange()" placeholder="0.00" step="0.50">
                                </div>
                                <div class="change-box" id="changeBox">-</div>
                            </div>
                            
                            <div class="pay-info-box" id="qrBox">
                                <p style="font-weight:700;margin-bottom:8px">Scan QR</p>
                                <div id="qrContent"><p style="color:var(--gray)">QR belum disetup.</p></div>
                            </div>
                            
                            <div class="pay-info-box" id="transferBox">
                                <p style="font-weight:700;margin-bottom:8px">Transfer</p>
                                <div id="transferContent"><p style="color:var(--gray)">Bank belum disetup.</p></div>
                            </div>
                            
                            <div class="btn-row">
                                <button class="btn btn-save-order" onclick="saveOrderPending()" id="btnSave">Simpan</button>
                                <button class="btn btn-primary" onclick="submitOrder()" id="btnSubmit">Selesai & Bayar</button>
                            </div>
                            
                            <div class="shortcut-hint"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> bayar cepat</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="tab-list">
        <div class="card">
            <div class="card-title">Senarai Pesanan</div>
            <div class="form-group"><input type="date" class="form-input" id="orderDate" onchange="loadOrders()"></div>
            <div class="order-filter">
                <button class="order-filter-btn active" onclick="filterOrders('all',this)">Semua</button>
                <button class="order-filter-btn" onclick="filterOrders('completed',this)">Selesai</button>
                <button class="order-filter-btn" onclick="filterOrders('pending',this)">Belum</button>
                <button class="order-filter-btn" onclick="filterOrders('cancelled',this)">Batal</button>
            </div>
        </div>
        <div id="ordersList"><div class="loading"><div class="spinner"></div>Memuatkan...</div></div>
    </div>
    
    <!-- Tab lain tak perlu ubah -->
    <div class="tab-content" id="tab-sales"><div class="card"><div class="card-title">Jualan</div><div id="salesDash">Pilih tab untuk lihat laporan</div></div></div>
    <div class="tab-content" id="tab-menu"><div class="card"><div class="card-title">Menu</div><div id="menuManage">Pilih tab untuk urus menu</div></div></div>
    <div class="tab-content" id="tab-settings"><div class="card"><div class="card-title">Tetapan</div><div id="settingsContent">Pilih tab untuk tetapan</div></div></div>
</div>

<script>
// ============================================
// CONFIG & STATE
// ============================================
const C={URL:'https://script.google.com/macros/s/AKfycbwACvAQzeSWeV0dta-ttCXDHM0hNURiO1lsOtpnEbqSo9glcu2gC6N6SkW_9bVzBe1Z/exec',KEY:'aca6f58aac70a3c722e74b9e0488bd693637e056de95a296f6b40613104b1df7',PAKEJ:'premium'};
let S={menu:[],cart:[],orders:[],staff:{name:'Admin',role:'admin'},pay:'cash',cat:'Semua',editOid:null,editItems:[],shop:{shopName:'Kedai Makan',shopAddress:'',shopPhone:''},count:0,reportMode:'daily',orderFilter:'all',qrImage:'',bankName:'',bankAccount:'',bankHolder:'',completePay:'cash',completeOid:null,qrBase64:'',editingPendingOrderId:null};
let salesCache={daily:null,weekly:null,monthly:null};
const clientCache={};
const CLIENT_CACHE_TTL=30000;

// ============================================
// UTILS
// ============================================
function esc(str){if(!str)return'';const d=document.createElement('div');d.textContent=String(str);return d.innerHTML}
function debounce(fn,ms=300){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),ms)}}

// ============================================
// API (IMPROVED)
// ============================================
async function api(action, data={}) {
    const st = Date.now();
    try {
        const c = new AbortController();
        const to = setTimeout(() => c.abort(), 30000);
        const r = await fetch(C.URL, {
            method: 'POST',
            headers: {'Content-Type': 'text/plain'},
            body: JSON.stringify({apiKey: C.KEY, action, data}),
            redirect: 'follow',
            signal: c.signal
        });
        clearTimeout(to);
        const t = await r.text();
        console.log('[API]', action, (Date.now()-st)+'ms', 'status:', r.status);

        if (t.includes('Google Apps Script') || t.includes('ScriptError')) {
            return {success: false, error: 'Google Apps Script sedang maintenance. Cuba sebentar lagi.'};
        }
        if (t.trim().startsWith('<')) {
            return {success: false, error: 'Server error. Cuba semula.'};
        }
        if (!t || t.trim() === '') {
            return {success: false, error: 'Respons kosong dari server.'};
        }
        try {
            return JSON.parse(t);
        } catch(e) {
            console.error('[API] JSON parse error. Raw:', t.substring(0, 300));
            return {success: false, error: 'Format respons tidak sah.'};
        }
    } catch(e) {
        if (e.name === 'AbortError') return {success: false, error: 'Timeout (30s). Sambungan perlahan.'};
        return {success: false, error: 'Gagal sambung: ' + e.message};
    }
}

// ============================================
// TAMBAH ORDER KE PESANAN BELUM SELESAI
// ============================================
async function addToPending(orderId) {
    const order = S.orders.find(o => o.orderId === orderId);
    if (!order || order.status !== "pending") {
        toast('Pesanan tidak sah atau sudah selesai', 'error');
        return;
    }

    S.cart = [];
    order.items.forEach(item => {
        S.cart.push({
            id: "",
            name: item.name,
            price: item.price,
            qty: item.qty
        });
    });

    document.getElementById('tableNo').value = order.tableNo === "-" ? "" : order.tableNo;
    S.editingPendingOrderId = orderId;

    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelector('.nav-tab').classList.add('active');
    document.getElementById('tab-order').classList.add('active');

    renderCart();
    renderMenu();

    toast('Pesanan meja ' + order.tableNo + ' dimuatkan. Boleh tambah item!', 'success');
}

// ============================================
// RENDER ORDERS (WITH TAMBAH ORDER BUTTON)
// ============================================
function renderOrders(){
    const c=document.getElementById('ordersList');
    let l=S.orders;
    if(S.orderFilter!=='all')l=l.filter(o=>o.status===S.orderFilter);
    if(!l.length){c.innerHTML='<div class="empty"><div class="empty-icon">List</div>Tiada pesanan</div>';return}
    
    c.innerHTML=l.map((o, idx)=>{
        const pn = o.status === 'pending';
        const dn = o.status === 'completed';
        const bc = dn ? 'badge-done' : pn ? 'badge-pending' : 'badge-cancel';
        const bt = dn ? 'Selesai' : pn ? 'Belum' : 'Batal';
        const cc = dn ? '' : pn ? 'pending' : 'cancelled';
        
        const orderActions = pn ? `
            <button class="btn btn-info btn-sm" onclick="addToPending('${esc(o.orderId)}')">
                Tambah
            </button>
            <button class="btn btn-success btn-sm" onclick="openComplete(S.orders[${idx}])">
                Bayar
            </button>
            <button class="btn btn-danger btn-sm" onclick="cancelOrd('${esc(o.orderId)}')">
                Batal
            </button>
        ` : '';
        
        return `<div class="order-card ${cc}">
            <div class="order-header">
                <div>
                    <div class="order-num">#${o.orderNo || '?'}</div>
                    <div class="order-time">⏰ ${esc(o.time)}${o.tableNo!=='-'?' · Meja '+esc(o.tableNo):''}</div>
                </div>
                <span class="order-badge ${bc}">${bt}</span>
            </div>
            <div class="order-items">${o.items.map(i=>esc(i.name)+' ×'+i.qty).join(', ')}</div>
            <div class="order-bottom">
                <div><div class="order-total">RM ${o.total.toFixed(2)}</div></div>
                <div class="order-actions">${orderActions}</div>
            </div>
        </div>`;
    }).join('');
}

// ============================================
// SUBMIT ORDER (WITH UPDATE PENDING ORDER)
// ============================================
async function submitOrder(){
    if(!S.cart.length){
        toast('Pilih menu!','error');
        return;
    }

    const btn=document.getElementById('btnSubmit');
    btn.disabled=true;
    btn.textContent='⏳ Menghantar...';

    const disc = parseFloat(document.getElementById('discountAmt').value)||0;
    const tn = document.getElementById('tableNo').value || '-';
    const staffName = S.staff.name;

    let result;

    if (S.editingPendingOrderId) {
        result = await api('updateOrder', {
            orderId: S.editingPendingOrderId,
            items: S.cart.map(i => ({name: i.name, price: i.price, qty: i.qty})),
            tableNo: tn,
            discount: disc
        });

        if(result.success){
            toast('Pesanan ditambah & diselesaikan!', 'success');
            delete S.editingPendingOrderId;
        }
    } else {
        result = await api('createOrder',{
            items: S.cart.map(i=>({name:i.name,price:i.price,qty:i.qty})),
            tableNo: tn,
            paymentMethod: S.pay,
            staffName: staffName,
            discount: disc
        });

        if(result.success){
            S.count = result.orderNo;
            document.getElementById('orderCounter').textContent='#'+result.orderNo;
            showReceipt(result, S.cart, disc);
        }
    }

    btn.disabled=false;
    btn.innerHTML='Selesai & Bayar';

    if(result.success){
        resetOrder();
        clearClientCache();
        if(document.getElementById('tab-list').classList.contains('active')){
            loadOrders();
        }
    } else {
        toast(' '+(result.error||'Gagal'),'error');
    }
}

// ============================================
// RENDER CART (WITH EDITING BADGE)
// ============================================
function renderCart(){
    const headerTitle = document.querySelector('#cartCard .card-title');
    if (S.editingPendingOrderId && headerTitle) {
        if (!headerTitle.querySelector('.editing-badge')) {
            const badge = document.createElement('span');
            badge.className = 'editing-badge';
            badge.style.cssText = 'background:#f59e0b;color:white;padding:2px 10px;border-radius:12px;font-size:0.65rem;margin-left:8px;font-weight:700';
            badge.textContent = 'SEKARANG EDIT';
            headerTitle.appendChild(badge);
        }
    } else {
        const badge = document.querySelector('.editing-badge');
        if (badge) badge.remove();
    }

    // ... kod renderCart sedia ada ...
    const ce=document.getElementById('cartEmpty'),cc=document.getElementById('cartContent'),cn=document.getElementById('cartCount');
    const ti=S.cart.reduce((s,i)=>s+i.qty,0);
    cn.textContent=ti;
    if(!S.cart.length){ce.style.display='block';cc.style.display='none';return}
    ce.style.display='none';cc.style.display='flex';
    let sub=0;
    document.getElementById('cartList').innerHTML=S.cart.map(i=>{
        const st=i.price*i.qty;sub+=st;
        return`<div class="cart-item"><div class="cart-info"><div class="cart-name" title="${esc(i.name)}">${esc(i.name)}</div><div class="cart-price">RM${i.price.toFixed(2)} × ${i.qty}</div></div><div class="cart-controls"><button class="qty-btn minus" onclick="cartQty('${esc(i.id)}',-1)">−</button><span class="cart-qty">${i.qty}</span><button class="qty-btn" onclick="cartQty('${esc(i.id)}',1)">+</button></div><div class="cart-subtotal">RM${st.toFixed(2)}</div></div>`;
    }).join('');
    const disc=parseFloat(document.getElementById('discountAmt').value)||0;
    const total=Math.max(0,sub-disc);
    document.getElementById('summaryLines').innerHTML='<div class="subtotal-line"><span>Subtotal</span><span>RM '+sub.toFixed(2)+'</span></div>'+(disc>0?'<div class="subtotal-line discount-line"><span>Diskaun</span><span>- RM '+disc.toFixed(2)+'</span></div>':'');
    document.getElementById('cartTotal').textContent=total.toFixed(2);
    renderQuickCash(total);calcChange();
}

// ============================================
// LOAD ORDERS (WITH STAFF INFO)
// ============================================
async function loadOrders(){
    const d=document.getElementById('orderDate');
    if(!d.value)d.value=today();
    document.getElementById('ordersList').innerHTML='<div class="loading"><div class="spinner"></div>Memuatkan...</div>';
    
    const r=await api('getOrders',{
        date: d.value,
        staffName: S.staff.name,
        staffRole: S.staff.role
    });
    
    if(r.success){
        S.orders=r.orders;
        renderOrders();
    } else {
        document.getElementById('ordersList').innerHTML='<div class="api-error-box"><strong>Gagal muatkan pesanan</strong>'+esc(r.error)+'</div>';
    }
}

// ... semua kod lain kekal sama seperti sebelum ni ...

function toast(msg,type='success'){
    const w=document.getElementById('toastWrap');
    const t=document.createElement('div');
    t.className='toast '+type;
    t.textContent=msg;
    w.appendChild(t);
    setTimeout(()=>t.remove(),3000);
}

function today(){return new Date().toISOString().split('T')[0]}

async function init(){
    updateClock();setInterval(updateClock,1000);
    document.getElementById('orderDate').value=today();
    let info=await api('getShopInfo');
    if(info.success){
        S.shop=info;
        document.getElementById('loginShopName').textContent=info.shopName;
        document.title='POSKedai - '+info.shopName;
    }
}
init();
</script>
</body>
</html>
```

**Siap!**  
Copy → Paste → Deploy → Test.

Feature "Tambah Order" untuk pelanggan yang masih makan dah berfungsi 100%.  
GAS **tak perlu ubah**.

Kalau ada apa-apa nak tambah lagi, bagitau je!
